<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="google-site-verification" content="SxtUWZeCB1kdMgucSmFlZL9HwwJmgQHGcp9w_p4Xtgc" />
<meta name="baidu-site-verification" content="Sil1fR2zak" />



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android," />





  <link rel="alternate" href="/atom.xml" title="做最好的自己" type="application/atom+xml" />




      <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="主要内容：">
<meta property="og:type" content="article">
<meta property="og:title" content="Android开发">
<meta property="og:url" content="http://www.bestzhangjin.com/2016/03/24/android/index.html">
<meta property="og:site_name" content="做最好的自己">
<meta property="og:description" content="主要内容：">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/1.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/2.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/3.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/4.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/5.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/6.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/7.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/8.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/9.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/10.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/11.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/12.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/13.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/14.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/15.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/16.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/17.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/18.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/19.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/20.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/21.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/22.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/23.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/24.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/25.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/26.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/27.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/28.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/29.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/30.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/31.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/32.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/33.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/34.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/35.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/36.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/37.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/38.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/39.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/40.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/41.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/42.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/43.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/44.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/45.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/46.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/47.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/48.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/49.png">
<meta property="og:image" content="http://www.bestzhangjin.com/img/android/50.png">
<meta property="og:updated_time" content="2016-05-28T02:10:14.684Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android开发">
<meta name="twitter:description" content="主要内容：">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Android开发 | 做最好的自己 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">做最好的自己</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android开发
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-03-24T19:42:20+08:00" content="2016-03-24">
              2016-03-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/24/android/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/24/android/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p>主要内容：<br><a id="more"></a></p>
<h1 id="u7B2C_u4E00_u7AE0__u73AF_u5883_u642D_u5EFA"><a href="#u7B2C_u4E00_u7AE0__u73AF_u5883_u642D_u5EFA" class="headerlink" title="第一章 环境搭建"></a>第一章 环境搭建</h1><p>Windows10+jdk8+android studio<br>android studio下载<a href="http://www.android-studio.org/" target="_blank" rel="external">http://www.android-studio.org/</a></p>
<h1 id="u7B2C_u4E8C_u7AE0_Android_u57FA_u7840_u77E5_u8BC6"><a href="#u7B2C_u4E8C_u7AE0_Android_u57FA_u7840_u77E5_u8BC6" class="headerlink" title="第二章 Android基础知识"></a>第二章 Android基础知识</h1><h2 id="1-_u4ECB_u7ECD"><a href="#1-_u4ECB_u7ECD" class="headerlink" title="1.介绍"></a>1.介绍</h2><p>本阶段包含Android理论知识，是Android应用开发的根基，要想以后有更长足的提高，这部分的知识需要耐心学习实践,在这里你将渐渐熟悉Android的方方面面目录结构：<br><img src="/img/android/1.png" alt="image"><br>Manifests：配置目录AndroidManifest.xml默认内容如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0"encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">manifest</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line"><span class="attribute">package</span>=<span class="value">"com.example.administrator.helloworld"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">application</span></span><br><span class="line"><span class="attribute">android:allowBackup</span>=<span class="value">"true"</span>//是否允许备份应用的数据，默认是<span class="attribute">true</span>,当备份数据的时候，它的数据会被备份下来。如果设为<span class="attribute">false</span>，那么绝对不会备份应用的数据，即使是备份整个系统。</span><br><span class="line"><span class="attribute">android:icon</span>=<span class="value">"@mipmap/ic_launcher"</span>//应用程序图标</span><br><span class="line"><span class="attribute">android:label</span>=<span class="value">"@string/app_name"</span>	//应用程序名字</span><br><span class="line"><span class="attribute">android:theme</span>=<span class="value">"@style/AppTheme"</span>&gt;</span><span class="comment">&lt;!--声明作为程序入口的Activity--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">activity</span></span><br><span class="line"><span class="attribute">android:name</span>=<span class="value">".MainActivity"</span>//<span class="attribute">Activity</span>用来与用户交互的主要工具，是用户打开程序的初始界面<span class="attribute">.</span>此处为引用程序默认启动的<span class="attribute">Activity</span></span><br><span class="line"><span class="attribute">android:label</span>=<span class="value">"@string/app_name"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span>//IntentFilter类表示Intent过滤器,大部分情况下,每一个component都会定义一个或多个IntentFilter,用于表明其可处理的Intent(Intent用于启动Activity,Service,以及BroadcastReceiver三种组件,同时还是组件之间通信的重要媒介。)。定义的方法:在<span class="tag">&lt;<span class="title">activity</span>&gt;</span>,<span class="tag">&lt;<span class="title">receiver</span>&gt;</span>,<span class="tag">&lt;<span class="title">service</span>&gt;</span>元素中增加一个或多个<span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span>子元素//android.intent.action.MAIN决定一个应用程序最先启动那个组 件,android.intent.category.LAUNCHER决定应用程序是否显示在程序列表里(说白了就是是否在桌面上显示一个图标)</span><br><span class="line">这两个属性组合情况：</span><br><span class="line">第一种情况：有MAIN,无LAUNCHER，程序列表中无图标</span><br><span class="line">原因：android.intent.category.LAUNCHER决定应用程序是否显示在程序列表里 </span><br><span class="line">第二种情况：无MAIN,有LAUNCHER，程序列表中无图标</span><br><span class="line">原因：android.intent.action.MAIN决定应用程序最先启动的Activity，如果没有Main，则不知启动哪个Activity，故也不会有图标出现</span><br><span class="line">所以这两个属性一般成对出现。</span><br><span class="line">如果一个应用中有两个组件intent-filter都添加了android.intent.action.MAIN和</span><br><span class="line">android.intent.category.LAUNCHER这两个属性， 则这个应用将会显示两个图标， 写在前面的组件先运行。</span><br><span class="line"><span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span>/&gt;</span>//"android.intent.action.MAIN"这个action的filter都能通过action测试</span><br><span class="line"><span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span>/&gt;</span>//如果一个intent没有定义category,则所有filter都可以通过category测试</span><br><span class="line"><span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">application</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Res：资源文件夹<br>Layout：布局 menu：菜单 mipmap：图片 values：dimens尺寸 strings字符串 styles样式</p>
<h2 id="2-Activity_u7EC4_u4EF6"><a href="#2-Activity_u7EC4_u4EF6" class="headerlink" title="2.Activity组件"></a>2.Activity组件</h2><p>Activity是Android四大基本组件之一，可以通过setContentView方法绑定一个布局用于呈现界面与用户进行交互，是Android开发必不可少的学习内容<br>核心内容：1.认识Activity 2.Activity绑定视图3.启动Activity软件环境：Android Studio<br>(1)认识ActivityActivity就是界面字符串引用规范(string.xml)<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android:label=<span class="string">"@string/app_name"</span>Strings.xml:&lt;resources&gt;</span><br><span class="line">&lt;<span class="type">string</span> <span class="property">name</span>=<span class="string">"app_name"</span>&gt;HelloWorld&lt;/<span class="type">string</span>&gt;</span><br><span class="line">&lt;<span class="type">string</span> <span class="property">name</span>=<span class="string">"hello_world"</span>&gt;Hello world!&lt;/<span class="type">string</span>&gt;</span><br><span class="line">&lt;<span class="type">string</span> <span class="property">name</span>=<span class="string">"action_settings"</span>&gt;Settings&lt;/<span class="type">string</span>&gt;</span><br><span class="line">&lt;/resources&gt;</span><br></pre></td></tr></table></figure></p>
<p>java下的mainactivity：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>&#123;</span><br><span class="line"><span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">setContentView(R.layout.activity_main);<span class="comment">//指定一个视图用来呈现视图，去掉则运行时没有界面</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>R.java：自动生成</p>
<p>(2)Activity绑定视图<br>修改activity绑定的布局：点击Layout右键单击-&gt;new-&gt;layout resource fille<br><img src="/img/android/2.png" alt="image"><br>生成的mylayout.xml内容如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0"encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line"><span class="attribute">android:orientation</span>=<span class="value">"vertical"</span>//<span class="attribute">vertical:</span>垂直布局，如往里面拉按钮将垂直排布</span><br><span class="line"></span><br><span class="line"><span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line"><span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>java下的mainactivity<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>&#123;</span><br><span class="line"><span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">setContentView(R.layout.activity_main);<span class="comment">//指定一个视图用来呈现视图，去掉则运行时没有界面,将setContentView(R.layout.activity_main);改为setContentView(R.layout.mylayout);就完成了</span></span><br></pre></td></tr></table></figure></p>
<p>(3)启动Activity<br>本课讲解如何创建一个 Activity，如何在 Manifest 文件中对Activity进行配置，以及如何使用 startActivity 函数启动一个 Activity。<br>java目录下mainactivity如下：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.mylayout);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>res目录的layout下的mylayout.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span> <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span>&gt;</span></span><br><span class="line">//此处是一个按钮</span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"启动另外一个Ativity"</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/btnStartAnotherAty"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>主程序mainactivity下：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.mylayout);</span><br><span class="line">    findViewById(R.id.btnStartAnotherAty).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建一个新的activity<br>注意：在java目录下也可以<br><img src="/img/android/3.png" alt="image"><br>新建的activity让其.xml输出如下<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView <span class="string">android:</span>text=<span class="string">"这是另外一个activity"</span> <span class="string">android:</span>layout_width=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">    android:</span>layout_height=<span class="string">"wrap_content"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main中点击事件修改如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">startActivity(<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,AnotherAty.<span class="keyword">class</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如此可以运行：<br>点击按钮-&gt;进入另外一个界面，按返回键回到按钮界面<br>改成如下可以跳转到网页<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line"><span class="comment">// startActivity(new Intent(MainActivity.this,AnotherAty.class));</span></span><br><span class="line">     startActivity(<span class="keyword">new</span> Intent(Intent.ACTION_VIEW, Uri.parse(<span class="string">"http://jikexueyuan.com"</span>)));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="2-_u8BA4_u8BC6_Activity__u7684_u751F_u547D_u5468_u671F"><a href="#2-_u8BA4_u8BC6_Activity__u7684_u751F_u547D_u5468_u671F" class="headerlink" title="2.认识 Activity 的生命周期"></a>2.认识 Activity 的生命周期</h2><p>核心内容：查看帮助文档;Activity生命周期<br>(1)查看帮助文档<br>帮助文档：<br>如下选中Documentation for Android SDK进行下载<br><img src="/img/android/4.png" alt="image"><br>之后有以下文件，打开就可以<br>F:/Android/sdk/docs/develop/index.html<br>之后点击develop-&gt;reference   点击See all API packages. 搜索activity如下，随便点击一个，因为都是继承来自activity的<br><img src="/img/android/5.png" alt="image"><br><img src="/img/android/6.png" alt="image"><br>选中android.app.Activity下拉如下：activity的生命周期图<br><img src="/img/android/7.png" alt="image"><br>如何看开发文档(是一本书)<br>点击develop下的API Guides从上往下看，整个能够看完就会是一个安卓高手<br><img src="/img/android/8.png" alt="image"></p>
<p>(2)认识 Activity 的生命周期<br>在mainactivity中添加如下代码：<br>和帮助文档一样—–7个函数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        System.out.print(<span class="string">"onCreate"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        System.out.print(<span class="string">"onResume"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">        System.out.print(<span class="string">"onPause"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        System.out.print(<span class="string">"onStop"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        System.out.print(<span class="string">"onDestroy"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRestart();</span><br><span class="line">        System.out.print(<span class="string">"onRestart"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">        System.out.print(<span class="string">"onStart"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>启动后效果如下：<br><img src="/img/android/9.png" alt="image"><br>Activity打开<br><img src="/img/android/10.png" alt="image"><br>启动模拟器之后执行oncreate onstart onresume 之后进入activity界面<br>按下home键进入桌面（activity界面消失）执行的是onpause onstop<br>点击最右边个键（呈现最近应用列表）：重新呈现activity界面，执行的函数是onrestart onstart onresume进入界面<br>按下后退键，界面消失，执行的是onpause,onstop,ondestory<br>点击最右边个键（呈现最近应用列表）：重新呈现activity界面，执行的函数是oncrate  onstart onresume进入界面,这是一个全新的生命周期<br><img src="/img/android/11.png" alt="image"></p>
<p>(3)在 Activity 跳转过程中的生命周期<br>新建一个activity，mainactivity（A）和anotherAty（B）<br>A代码如下：<br>Activity_main:添加按钮<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动B Activity"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btn_B_StartAnotherAty"</span></span><br><span class="line">    android:layout_alignParentTop=<span class="string">"true"</span></span><br><span class="line">    android:layout_alignParentStart=<span class="string">"true"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        findViewById(R.id.btnStartAnotherAty).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                startActivity(<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,AnotherAty.class));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        System.out.print(<span class="string">"A onCreate"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        System.out.print(<span class="string">"A onResume"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">        System.out.print(<span class="string">"A onPause"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        System.out.print(<span class="string">"A onStop"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        System.out.print(<span class="string">"A onDestroy"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRestart();</span><br><span class="line">        System.out.print(<span class="string">"A onRestart"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">        System.out.print(<span class="string">"A onStart"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>B.java:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnotherAty</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_another_aty);</span><br><span class="line">        System.out.print(<span class="string">"B onCreate"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onResume();</span><br><span class="line">        System.out.print(<span class="string">"B onResume"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">        System.out.print(<span class="string">"B onPause"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop();</span><br><span class="line">        System.out.print(<span class="string">"B onStop"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        System.out.print(<span class="string">"B onDestroy"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRestart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRestart();</span><br><span class="line">        System.out.print(<span class="string">"B onRestart"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart();</span><br><span class="line">        System.out.print(<span class="string">"B onStart"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行程序：<br>执行A onCreate , A onStart ,A onResume, A界面显示<br>点击A按钮，依次执行A onPouse,B onCreate,B onstart,B resume,A stop，显示B界面<br>此时用的B是不透明的，完全遮住了A，如果B透明，不完全遮住A呢？<br>在AndroidMainfest.xml下设置B，使他为一个对话框<br>代码如下：（我自己添加的有问题—应该是差什么包）<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">android:</span>theme=<span class="string">"@style/Base.Theme.AppCompat.Dialog"</span></span><br></pre></td></tr></table></figure></p>
<p>极客学院如下：<br><img src="/img/android/12.png" alt="image"><br>此时执行A onPouse, B onCreate,B onstart,B onResume,此时B明A暗<br>在B外的其他空白处点击一下，B关闭，执行B onPause,.A onResume,B onStop,B onDestory.A显示</p>
<h2 id="3-_u5728_Activity__u4E4B_u95F4_u4F20_u9012_u53C2_u6570"><a href="#3-_u5728_Activity__u4E4B_u95F4_u4F20_u9012_u53C2_u6570" class="headerlink" title="3.在 Activity 之间传递参数"></a>3.在 Activity 之间传递参数</h2><p>核心内容：在 Activity 之间传递简单数据;在 Activity 之间传递复杂数据;在 Activity 之间传递自定义值对象<br>(1)传递简单数据<br>设置activity_another_aty.xml如下：<br>设置输出框id=tv<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView <span class="string">android:</span>text=<span class="string">"这是另外一个activity"</span> <span class="string">android:</span>layout_width=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">    android:</span>layout_height=<span class="string">"wrap_content"</span> <span class="string">android:</span>id=<span class="string">"@+id/tv"</span>/&gt;</span><br></pre></td></tr></table></figure></p>
<p>Activity_main.xml下加按钮<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动另一个Activity"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btn_B_StartAnotherAty"</span></span><br><span class="line">    android:layout_alignParentTop=<span class="string">"true"</span></span><br><span class="line">    android:layout_alignParentStart=<span class="string">"true"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>设置mainactivity.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    findViewById(R.id.btn_B_StartAnotherAty).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, AnotherAty.class);</span><br><span class="line">            i.putExtra(<span class="string">"data"</span>,<span class="string">"hello,me"</span>);<span class="comment">//传参数</span></span><br><span class="line">            startActivity(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>anotheraty.java中获取：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AnotherAty</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">TextView</span> tv;<span class="comment">//访问已经写好的Textview---输出框</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.activity_another_aty);</span><br><span class="line"></span><br><span class="line">        <span class="type">Intent</span> i = getIntent();</span><br><span class="line">        tv = (<span class="type">TextView</span>) findViewById(<span class="type">R</span>.id.tv);<span class="comment">//findViewById返回为view类型，需要强转</span></span><br><span class="line">        tv.setText(i.getStringExtra(<span class="string">"data"</span>));        <span class="comment">//为输出框设置字符串(getStringExtra("data")-获取到一个字符串的数据,名字是data)</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>如上运行之后点击按钮就可以跳转到另外一个界面：输出hello，me</p>
<p>(2)传递数据包Bundle<br>对上面的代码进行一定的修改就可以<br>Mainactivity.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line">    findViewById(R.id.btn_B_StartAnotherAty).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, AnotherAty.class);</span><br><span class="line">           <span class="comment">// i.putExtra("data","hello,me");//传参数  名字是data 值是hello,me</span></span><br><span class="line">            Bundle b = <span class="keyword">new</span> Bundle();<span class="comment">//数据包</span></span><br><span class="line">            b.putString(<span class="string">"name"</span>,<span class="string">"liming"</span>);</span><br><span class="line">            b.putInt(<span class="string">"age"</span>, <span class="number">2</span>);</span><br><span class="line">            b.putString(<span class="string">"sex"</span>, <span class="string">"man"</span>);</span><br><span class="line">            i.putExtras(b);<span class="comment">//区别于putExtra</span></span><br><span class="line">            startActivity(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>AnotherAty.java<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="literal">void</span> onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super<span class="built_in">.</span>onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R<span class="built_in">.</span>layout<span class="built_in">.</span>activity_another_aty);</span><br><span class="line"></span><br><span class="line">    Intent i = getIntent();</span><br><span class="line">     tv = (TextView) findViewById(R<span class="built_in">.</span>id<span class="built_in">.</span>tv);</span><br><span class="line">   <span class="comment">// tv.setText(i.getStringExtra("data"));        //为输出框设置字符串(getStringExtra("data")-获取到一个字符串的数据,名字是data)</span></span><br><span class="line">    Bundle <span class="built_in">data</span> = i<span class="built_in">.</span>getExtras();</span><br><span class="line">    tv<span class="built_in">.</span>setText(<span class="built_in">String</span><span class="built_in">.</span>format(<span class="string">"name=%s,age=%d,sex=%s,name1=%s"</span>,<span class="built_in">data</span><span class="built_in">.</span>getString(<span class="string">"name"</span>),<span class="built_in">data</span><span class="built_in">.</span>getInt(<span class="string">"age"</span>),<span class="built_in">data</span><span class="built_in">.</span>getString(<span class="string">"sex"</span>,<span class="string">"woman"</span>),<span class="built_in">data</span><span class="built_in">.</span>getString(<span class="string">"name1"</span>,<span class="string">"张"</span>)));</span><br><span class="line">    <span class="comment">//name1再包里面没有输出为这里设置的默认值，sex传入有值，将不再用这里设置的默认值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>效果图<br><img src="/img/android/13.png" alt="image"><br><img src="/img/android/14.png" alt="image"><br>当然，也可以用putextra(String name,Bundle value)传递Bundle<br>Mainactivity.java<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, AnotherAty.<span class="keyword">class</span>);</span><br><span class="line">   <span class="comment">// i.putExtra("data","hello,me");//传参数  名字是data 值是hello,me</span></span><br><span class="line">    Bundle b = <span class="keyword">new</span> Bundle();<span class="comment">//数据包</span></span><br><span class="line">    b.putString(<span class="string">"name"</span>,<span class="string">"liming"</span>);</span><br><span class="line">    b.putInt(<span class="string">"age"</span>, <span class="number">2</span>);</span><br><span class="line">    b.putString(<span class="string">"sex"</span>, <span class="string">"man"</span>);</span><br><span class="line">   <span class="comment">// i.putExtras(b);//区别于putExtra</span></span><br><span class="line">    i.putExtra(<span class="string">"data"</span>,b);</span><br><span class="line">    startActivity(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>AnotherAty.java<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="literal">void</span> onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super<span class="built_in">.</span>onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R<span class="built_in">.</span>layout<span class="built_in">.</span>activity_another_aty);</span><br><span class="line"></span><br><span class="line">    Intent i = getIntent();</span><br><span class="line">     tv = (TextView) findViewById(R<span class="built_in">.</span>id<span class="built_in">.</span>tv);</span><br><span class="line">   <span class="comment">// tv.setText(i.getStringExtra("data"));        //为输出框设置字符串(getStringExtra("data")-获取到一个字符串的数据,名字是data)</span></span><br><span class="line">  <span class="comment">//  Bundle data = i.getExtras();   //getExtras()传参数时接收函数</span></span><br><span class="line">    Bundle <span class="built_in">data</span> = i<span class="built_in">.</span>getBundleExtra(<span class="string">"data"</span>);<span class="comment">//getExtra()传包时接收函数</span></span><br><span class="line">    tv<span class="built_in">.</span>setText(<span class="built_in">String</span><span class="built_in">.</span>format(<span class="string">"name=%s,age=%d,sex=%s,name1=%s"</span>,<span class="built_in">data</span><span class="built_in">.</span>getString(<span class="string">"name"</span>), <span class="built_in">data</span><span class="built_in">.</span>getInt(<span class="string">"age"</span>),<span class="built_in">data</span><span class="built_in">.</span>getString(<span class="string">"sex"</span>,<span class="string">"woman"</span>),<span class="built_in">data</span><span class="built_in">.</span>getString(<span class="string">"name1"</span>,<span class="string">"张"</span>)));</span><br><span class="line">    <span class="comment">//name1再包里面没有输出为这里设置的默认值，sex传入有值，将不再用这里设置的默认值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行效果同上</p>
<p>(3)传递值对象<br>值对象：自定义的有数据类型的对象<br>如传递一个数据类型user<br>新建一个user.java类：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span>(<span class="params"><span class="keyword">int</span> age, String name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span>(<span class="params">String name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span>(<span class="params"><span class="keyword">int</span> age</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mainactivity.java<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i.putExtra(<span class="string">"User"</span>,<span class="keyword">new</span> User(<span class="string">"张三丰"</span>,<span class="number">25</span>));<span class="comment">//提示错误！</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/android/15.png" alt="image"><br>User需要实现parcelable或者Serializable序列化<br>修改User<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by zhang on 2016/1/11.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">( String name,<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mainactivity.java传参数：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, AnotherAty.<span class="keyword">class</span>);</span><br><span class="line">               <span class="comment">// i.putExtra("data","hello,me");//传参数  名字是data 值是hello,me</span></span><br><span class="line"><span class="comment">//                Bundle b = new Bundle();//数据包</span></span><br><span class="line"><span class="comment">//                b.putString("name","liming");</span></span><br><span class="line"><span class="comment">//                b.putInt("age", 2);</span></span><br><span class="line"><span class="comment">//                b.putString("sex", "man");</span></span><br><span class="line"><span class="comment">//               // i.putExtras(b);//区别于putExtra</span></span><br><span class="line"><span class="comment">//                i.putExtra("data",b);</span></span><br><span class="line">                i.putExtra(<span class="string">"User"</span>,<span class="keyword">new</span> User(<span class="string">"张三丰"</span>,<span class="number">25</span>));</span><br><span class="line">                startActivity(i);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></p>
<p>anotheraty.java获取参数：<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">protected void <span class="keyword">on</span>Create(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.<span class="keyword">on</span>Create(savedInstanceState);</span><br><span class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_another_aty);</span><br><span class="line"></span><br><span class="line">        Intent i = getIntent();</span><br><span class="line">         tv = (TextView) findViewById(R.id.tv);</span><br><span class="line">       // tv.<span class="built_in">set</span>Text(i.getStringExtra(<span class="string">"data"</span>));        //为输出框设置字符串(getStringExtra(<span class="string">"data"</span>)-获取到一个字符串的数据,名字是data)</span><br><span class="line">      //  Bundle data = i.getExtras();   //getExtras()传参数时接收函数</span><br><span class="line">//        Bundle data = i.getBundleExtra(<span class="string">"data"</span>);//getExtra()传包时接收函数</span><br><span class="line">//        tv.<span class="built_in">set</span>Text(String.format(<span class="string">"name=%s,age=%d,sex=%s,name1=%s"</span>,data.getString(<span class="string">"name"</span>), data.getInt(<span class="string">"age"</span>),data.getString(<span class="string">"sex"</span>,<span class="string">"woman"</span>),data.getString(<span class="string">"name1"</span>,<span class="string">"张"</span>)));</span><br><span class="line">        //name1再包里面没有输出为这里设置的默认值，sex传入有值，将不再用这里设置的默认值</span><br><span class="line"></span><br><span class="line">        //取User</span><br><span class="line">        User <span class="keyword">user</span>= (User)i.getSerializableExtra(<span class="string">"User"</span>);</span><br><span class="line">//注意：传参获取必须名字一样：getSerializableExtra(<span class="string">"User"</span>)不能用小写的<span class="string">"user"</span>,因为传参用的大写i.putExtra(<span class="string">"User"</span>,new User(<span class="string">"张三丰"</span>,<span class="number">25</span>));否则编译通过，不能运行</span><br><span class="line">tv.<span class="built_in">set</span>Text(String.format(<span class="string">"user.info(name=%s,age=%d)"</span>,<span class="keyword">user</span>.getName(), <span class="keyword">user</span>.getAge()));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行点击按钮时显示：user.info(name=张三丰,age=25)</p>
<p>但是与parcelable相比，Serializable效率低<br>Parcelable是安卓的，速度快，但是要实现两个方法<br>describeContents()<br>writeToParcel(Parcel dest, int flags)需要手动写数据 执行过程中会自动执行到这个函数<br>再创建一个泛型<br>Parcelable具体实现如下：<br>User.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.os.Parcel;</span><br><span class="line"><span class="keyword">import</span> android.os.Parcelable;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import java.io.Serializable;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by zhang on 2016/1/11.</span><br><span class="line"> */</span></span><br><span class="line"><span class="comment">//public class User implements Serializable&#123;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Parcelable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">( String name,<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel dest, <span class="keyword">int</span> flags)</span> </span>&#123;</span><br><span class="line">        dest.writeString(getName());<span class="comment">//这里怎么写的Creator中怎么读 多个string时可以用Bundle</span></span><br><span class="line">        dest.writeInt(getAge());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个泛型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Creator&lt;User&gt; CREATOR = <span class="keyword">new</span> Creator&lt;User&gt;() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> User <span class="title">createFromParcel</span><span class="params">(Parcel source)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> User(source.readString(),source.readByte());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> User[] newArray(<span class="keyword">int</span> size) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> User[size];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mainactivity.java<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, AnotherAty.<span class="keyword">class</span>);</span><br><span class="line">               <span class="comment">// i.putExtra("data","hello,me");//传参数  名字是data 值是hello,me</span></span><br><span class="line"><span class="comment">//                Bundle b = new Bundle();//数据包</span></span><br><span class="line"><span class="comment">//                b.putString("name","liming");</span></span><br><span class="line"><span class="comment">//                b.putInt("age", 2);</span></span><br><span class="line"><span class="comment">//                b.putString("sex", "man");</span></span><br><span class="line"><span class="comment">//               // i.putExtras(b);//区别于putExtra</span></span><br><span class="line"><span class="comment">//                i.putExtra("data",b);</span></span><br><span class="line">                i.putExtra(<span class="string">"User"</span>,<span class="keyword">new</span> User(<span class="string">"张三丰"</span>,<span class="number">25</span>));</span><br><span class="line">                startActivity(i);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></p>
<p>anotheraty.java<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">protected void <span class="keyword">on</span>Create(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.<span class="keyword">on</span>Create(savedInstanceState);</span><br><span class="line">        <span class="built_in">set</span>ContentView(R.layout.activity_another_aty);</span><br><span class="line"></span><br><span class="line">        Intent i = getIntent();</span><br><span class="line">         tv = (TextView) findViewById(R.id.tv);</span><br><span class="line">       // tv.<span class="built_in">set</span>Text(i.getStringExtra(<span class="string">"data"</span>));        //为输出框设置字符串(getStringExtra(<span class="string">"data"</span>)-获取到一个字符串的数据,名字是data)</span><br><span class="line">      //  Bundle data = i.getExtras();   //getExtras()传参数时接收函数</span><br><span class="line">//        Bundle data = i.getBundleExtra(<span class="string">"data"</span>);//getExtra()传包时接收函数</span><br><span class="line">//        tv.<span class="built_in">set</span>Text(String.format(<span class="string">"name=%s,age=%d,sex=%s,name1=%s"</span>,data.getString(<span class="string">"name"</span>), data.getInt(<span class="string">"age"</span>),data.getString(<span class="string">"sex"</span>,<span class="string">"woman"</span>),data.getString(<span class="string">"name1"</span>,<span class="string">"张"</span>)));</span><br><span class="line">        //name1再包里面没有输出为这里设置的默认值，sex传入有值，将不再用这里设置的默认值</span><br><span class="line"></span><br><span class="line">        //取User</span><br><span class="line">//        User <span class="keyword">user</span>= (User)i.getSerializableExtra(<span class="string">"User"</span>);//用什么方法实现的就用什么方法获取</span><br><span class="line">        //注意：传参获取必须名字一样：getSerializableExtra(<span class="string">"User"</span>)不能用小写的<span class="string">"user"</span>,因为传参用的大写i.putExtra(<span class="string">"User"</span>,new User(<span class="string">"张三丰"</span>,<span class="number">25</span>));否则编译通过，不能运行</span><br><span class="line">       User <span class="keyword">user</span>= i.getParcelableExtra(<span class="string">"User"</span>);//用什么方法实现的就用什么方法获取</span><br><span class="line">        tv.<span class="built_in">set</span>Text(String.format(<span class="string">"user.info(name=%s,age=%d)"</span>,<span class="keyword">user</span>.getName(), <span class="keyword">user</span>.getAge()));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行效果与上面一样</p>
<p>(4)获取 Activity 的返回参数<br>Activity_another_aty设置垂直排列并设置一个输入框和按钮，并在对应java中进行设置<br>Activity_main中添加一个输出框textview,对应main.Java中进行定义<br>Activity_Main.xml:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span> android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:orientation=<span class="string">"vertical"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span> android:paddingLeft=<span class="string">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    android:paddingRight=<span class="string">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    android:paddingTop=<span class="string">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    android:paddingBottom=<span class="string">"@dimen/activity_vertical_margin"</span> tools:context=<span class="string">".MainActivity"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:<span class="type">text</span>=<span class="string">"启动另一个Activity"</span></span><br><span class="line">        android:<span class="property">id</span>=<span class="string">"@+id/btn_B_StartAnotherAty"</span></span><br><span class="line">        android:layout_alignParentTop=<span class="string">"true"</span></span><br><span class="line">        android:layout_alignParentStart=<span class="string">"true"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:<span class="type">text</span>=<span class="string">"New Text"</span></span><br><span class="line">        android:<span class="property">id</span>=<span class="string">"@+id/textView"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>Activity_another_aty.xml:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout <span class="string">xmlns:</span>android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line"><span class="label">    xmlns:</span>tools=<span class="string">"http://schemas.android.com/tools"</span> <span class="string">android:</span>layout_width=<span class="string">"match_parent"</span></span><br><span class="line"><span class="label">    android:</span>layout_height=<span class="string">"match_parent"</span> <span class="string">android:</span>paddingLeft=<span class="string">"@dimen/activity_horizontal_margin"</span></span><br><span class="line"><span class="label">    android:</span>paddingRight=<span class="string">"@dimen/activity_horizontal_margin"</span></span><br><span class="line"><span class="label">    android:</span>paddingTop=<span class="string">"@dimen/activity_vertical_margin"</span></span><br><span class="line"><span class="label">    android:</span>paddingBottom=<span class="string">"@dimen/activity_vertical_margin"</span></span><br><span class="line"><span class="label"></span><br><span class="line">    android:</span>orientation=<span class="string">"vertical"</span></span><br><span class="line"><span class="label">    tools:</span>context=<span class="string">"com.example.zhang.helloworld.AnotherAty"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView <span class="string">android:</span>text=<span class="string">"这是另外一个activity"</span> <span class="string">android:</span>layout_width=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">        android:</span>layout_height=<span class="string">"wrap_content"</span> <span class="string">android:</span>id=<span class="string">"@+id/tv"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line"><span class="label">        android:</span>layout_width=<span class="string">"match_parent"</span></span><br><span class="line"><span class="label">        android:</span>layout_height=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">        android:</span>id=<span class="string">"@+id/editText"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line"><span class="label">        android:</span>layout_width=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">        android:</span>layout_height=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">        android:</span>text=<span class="string">"Send Back"</span></span><br><span class="line"><span class="label">        android:</span>id=<span class="string">"@+id/button"</span> /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TextView textView;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        textView = (TextView) findViewById(R.id.textView);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.btn_B_StartAnotherAty).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, AnotherAty.class);</span><br><span class="line">               <span class="comment">// i.putExtra("data","hello,me");//传参数  名字是data 值是hello,me</span></span><br><span class="line"><span class="comment">//                Bundle b = new Bundle();//数据包</span></span><br><span class="line"><span class="comment">//                b.putString("name","liming");</span></span><br><span class="line"><span class="comment">//                b.putInt("age", 2);</span></span><br><span class="line"><span class="comment">//                b.putString("sex", "man");</span></span><br><span class="line"><span class="comment">//               // i.putExtras(b);//区别于putExtra</span></span><br><span class="line"><span class="comment">//                i.putExtra("data",b);</span></span><br><span class="line">                i.putExtra(<span class="string">"User"</span>, <span class="keyword">new</span> User(<span class="string">"张三丰"</span>, <span class="number">25</span>));</span><br><span class="line"><span class="comment">//                startActivity(i);//因为要接收传回的参数，所以不能再用这个函数</span></span><br><span class="line">                startActivityForResult(i,<span class="number">0</span>);<span class="comment">//0---请求的代码：请求的代码传过去再传回来，可以用于代表此次请求的意义是什么</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重写函数</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="comment">//此函数可以获取到请求码，也可以获取到结果码</span></span><br><span class="line">    <span class="comment">//data对应的是传进来的setResult(1,i);中的i</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onActivityResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">int</span> resultCode, Intent data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, data);</span><br><span class="line">        textView.setText(<span class="string">"另一个activity返回的是"</span>+data.getStringExtra(<span class="string">"data"</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>another_aty.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.zhang.helloworld;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.Menu;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnotherAty</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>  TextView tv;</span><br><span class="line">    <span class="keyword">private</span> EditText editText;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_another_aty);</span><br><span class="line"></span><br><span class="line">        Intent i = getIntent();</span><br><span class="line">        tv = (TextView) findViewById(R.id.tv);</span><br><span class="line">        editText= (EditText) findViewById(R.id.editText);<span class="comment">//初始化</span></span><br><span class="line">        <span class="comment">// tv.setText(i.getStringExtra("data"));        //为输出框设置字符串(getStringExtra("data")-获取到一个字符串的数据,名字是data)</span></span><br><span class="line">        <span class="comment">//  Bundle data = i.getExtras();   //getExtras()传参数时接收函数</span></span><br><span class="line"><span class="comment">//        Bundle data = i.getBundleExtra("data");//getExtra()传包时接收函数</span></span><br><span class="line"><span class="comment">//        tv.setText(String.format("name=%s,age=%d,sex=%s,name1=%s",data.getString("name"), data.getInt("age"),data.getString("sex","woman"),data.getString("name1","张")));</span></span><br><span class="line">        <span class="comment">//name1再包里面没有输出为这里设置的默认值，sex传入有值，将不再用这里设置的默认值</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//取User</span></span><br><span class="line"><span class="comment">//        User user= (User)i.getSerializableExtra("User");//用什么方法实现的就用什么方法获取</span></span><br><span class="line">        <span class="comment">//注意：传参获取必须名字一样：getSerializableExtra("User")不能用小写的"user",因为传参用的大写i.putExtra("User",new User("张三丰",25));否则编译通过，不能运行</span></span><br><span class="line">        User user= i.getParcelableExtra(<span class="string">"User"</span>);<span class="comment">//用什么方法实现的就用什么方法获取</span></span><br><span class="line">        tv.setText(String.format(<span class="string">"user.info(name=%s,age=%d)"</span>,user.getName(), user.getAge()));</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.button).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                Intent i=<span class="keyword">new</span> Intent();</span><br><span class="line">                i.putExtra(<span class="string">"data"</span>,editText.getText().toString());</span><br><span class="line">                setResult(<span class="number">1</span>, i);<span class="comment">//设置返回值setResult(状态码，值)</span></span><br><span class="line">                finish();<span class="comment">//直接把当前的activity给结束掉</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_another_aty, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">        <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">        <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">        <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line">        <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onOptionsItemSelected</span><span class="params">(item)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行效果：输出返回值<br><img src="/img/android/16.png" alt="image"></p>
<h2 id="4-Android__u4E2D_Activity__u542F_u52A8_u6A21_u5F0F"><a href="#4-Android__u4E2D_Activity__u542F_u52A8_u6A21_u5F0F" class="headerlink" title="4.Android 中 Activity 启动模式"></a>4.Android 中 Activity 启动模式</h2><p>核心内容：Activity Standard 启动模式;Activity SingleTop 启动模式;Activity SingleTask 启动模式;Activity SingleInstance 启动模式<br>(1)标准启动模式<br>标准启动模式就是默认的启动模式<br>Activity_main.xml:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView android:<span class="type">text</span>=<span class="string">"@string/hello_world"</span> android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/tv"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></p>
<p>Mainactivity.java:<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TextView tv;</span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    tv= (TextView) findViewById(R.id.tv);</span><br><span class="line">    <span class="comment">//TaskID----任务ID    Current activity id：当前activity的实例ID</span></span><br><span class="line">    tv.setText(String.format(<span class="string">"TaskID:%d\n,Current activity id:%s"</span>,getTaskId(),toString()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行效果<br><img src="/img/android/17.png" alt="image"><br>再加一个button之后<br>Activity_main.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span> <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span> <span class="attribute">android:paddingLeft</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span></span><br><span class="line">    <span class="attribute">android:paddingRight</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingTop</span>=<span class="value">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingBottom</span>=<span class="value">"@dimen/activity_vertical_margin"</span> <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">TextView</span> <span class="attribute">android:text</span>=<span class="value">"@string/hello_world"</span> <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/tv"</span></span><br><span class="line">    /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- android:textAllCaps="false":取消默认的全部大写 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span></span><br><span class="line">        <span class="attribute">android:textAllCaps</span>=<span class="value">"false"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"启动mainactivity"</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/btnStartSelf"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Mainactivity.java:<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TextView tv;</span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    tv= (TextView) findViewById(R.id.tv);</span><br><span class="line">    <span class="comment">//TaskID----任务ID    Current activity id：当前activity的实例ID</span></span><br><span class="line">    tv.setText(String.format(<span class="string">"TaskID:%d\n,Current activity id:%s"</span>,getTaskId(),toString()));</span><br><span class="line"></span><br><span class="line">    findViewById(R.id.btnStartSelf).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            startActivity(<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,MainActivity.class));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行效果<br><img src="/img/android/18.png" alt="image"><br>点击按钮后taskid没有变，而当前activity的id改变<br>任务栈：启动的第一个实例放入其中，第2,3…个实例也是放入其中<br>按后退键可以弹出栈点的实例，呈现上一个activity的实例<br>在Androidmanifest.xml中可以进行启动模式配置<br>默认的是stadard<br><img src="/img/android/19.png" alt="image"></p>
<p>(2)SingleTop 模式<br>把上面的Androidmanifest.xml中配置改为SingleTop后运行<br><img src="/img/android/20.png" alt="image"><br>此时点击按钮显示没有任何改变<br>再建一个activity测试<br>注意：同一个文件设置ID不能一样，不同的文件设置ID可以相同<br>程序如下：<br>Activity_main.xml与activity_baty.xml完全一样<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">xmlns:tools</span>=<span class="value">"http://schemas.android.com/tools"</span> <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span> <span class="attribute">android:paddingLeft</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span></span><br><span class="line">    <span class="attribute">android:paddingRight</span>=<span class="value">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingTop</span>=<span class="value">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    <span class="attribute">android:paddingBottom</span>=<span class="value">"@dimen/activity_vertical_margin"</span> <span class="attribute">tools:context</span>=<span class="value">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">TextView</span> <span class="attribute">android:text</span>=<span class="value">"@string/hello_world"</span> <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/tv"</span></span><br><span class="line">    /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- android:textAllCaps="false":取消默认的全部大写 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span></span><br><span class="line">        <span class="attribute">android:textAllCaps</span>=<span class="value">"false"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"启动mainactivity"</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/btnStartMain"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span></span><br><span class="line">        <span class="attribute">android:textAllCaps</span>=<span class="value">"false"</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"启动BAty"</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/btnStartBty"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Mainactivity.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">TextView</span> tv;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        tv= (<span class="type">TextView</span>) findViewById(<span class="type">R</span>.id.tv);</span><br><span class="line">        <span class="comment">//TaskID----任务ID    Current activity id：当前activity的实例ID</span></span><br><span class="line">        tv.setText(<span class="type">String</span>.format(<span class="string">"TaskID:%d\n,Current activity id:%s"</span>,getTaskId(),toString()));</span><br><span class="line"></span><br><span class="line">        findViewById(<span class="type">R</span>.id.btnStartMain).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">                startActivity(<span class="keyword">new</span> <span class="type">Intent</span>(<span class="type">MainActivity</span>.<span class="keyword">this</span>, <span class="type">MainActivity</span>.<span class="keyword">class</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        findViewById(<span class="type">R</span>.id.btnStartBty).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">                startActivity(<span class="keyword">new</span> <span class="type">Intent</span>(<span class="type">MainActivity</span>.<span class="keyword">this</span>, <span class="type">BAty</span>.<span class="keyword">class</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>BAty.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">BAty</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">TextView</span> tv;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.activity_baty);</span><br><span class="line"></span><br><span class="line">        tv= (<span class="type">TextView</span>) findViewById(<span class="type">R</span>.id.tv);</span><br><span class="line">        tv.setText(<span class="type">String</span>.format(<span class="string">"TaskID:%d\n,Current activity id:%s"</span>, getTaskId(), toString()));</span><br><span class="line"></span><br><span class="line">        findViewById(<span class="type">R</span>.id.btnStartMain).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">                startActivity(<span class="keyword">new</span> <span class="type">Intent</span>(<span class="type">BAty</span>.<span class="keyword">this</span>, <span class="type">MainActivity</span>.<span class="keyword">class</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        findViewById(<span class="type">R</span>.id.btnStartBty).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">                startActivity(<span class="keyword">new</span> <span class="type">Intent</span>(<span class="type">BAty</span>.<span class="keyword">this</span>, <span class="type">BAty</span>.<span class="keyword">class</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>效果如下<br><img src="/img/android/21.png" alt="image"><br>在主界面（main界面）点击跳转到自己, taskid不变，实例ID不变<br>在主界面（main界面）点击跳转到Bty, taskid不变，实例ID改变<br>在Bty界面点击跳转到main界面，taskid不变，实例ID改变，而且与前次的实例ID不一样<br>在Bty界面点击跳转到自己界面，taskid不变，实例ID改变<br>点击后退可以一直退</p>
<p>(3)SingleTask 与 SingleInstance 模式<br>将androidmainfest.xml设置为singletask<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">android:</span>launchMode=<span class="string">"singleTask"</span> &gt;</span><br></pre></td></tr></table></figure></p>
<p>其他与2.4.2相同，运行如下<br>在主界面（main界面）点击跳转到自己, taskid不变，实例ID不变<br>在主界面（main界面）点击跳转到Bty, taskid不变，实例ID改变<br>在Bty界面点击跳转到main界面，taskid不变，实例ID改变，而且与前次的实例ID一样<br>在Bty界面点击跳转到自己界面，taskid不变，实例ID改变<br>点击后退退到main界面，在main界面点击后退直接退出<br>Main activity永远只有一个</p>
<p>将androidmainfest.xml设置为SingleInstance时main与Bty不是同一个栈<br>在主界面（main界面）点击跳转到自己, taskid不变，实例ID不变<br>在主界面（main界面）点击跳转到Bty, taskid改变，实例ID改变<br>在Bty界面点击跳转到main界面，taskid改变，实例ID改变，而且与前次的实例ID一样taskid也是相同<br>在Bty界面点击跳转到自己界面，taskid不变，实例ID改变<br>在一个界面点击后退后退到的界面如果是栈顶，再点击后退这个栈退出，如果有退到另外一个栈，则显示另外一个栈，点击后退如果是这个栈的栈顶则直接退出！</p>
<h2 id="5-_u5728_Android__u4E2D_Intent__u7684_u6982_u5FF5_u53CA_u5E94_u7528"><a href="#5-_u5728_Android__u4E2D_Intent__u7684_u6982_u5FF5_u53CA_u5E94_u7528" class="headerlink" title="5.在 Android 中 Intent 的概念及应用"></a>5.在 Android 中 Intent 的概念及应用</h2><p>核心内容：隐式 Intent;显式 Intent<br>(1)显式Intent<br>分别新建一个类和一个activity,并将他们绑定，需要在androidmainfest.xml注册才能用！最后进行intent配置。<br>Activity_main.xml<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;RelativeLayout <span class="string">xmlns:</span>android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line"><span class="label">    xmlns:</span>tools=<span class="string">"http://schemas.android.com/tools"</span> <span class="string">android:</span>layout_width=<span class="string">"match_parent"</span></span><br><span class="line"><span class="label">    android:</span>layout_height=<span class="string">"match_parent"</span> <span class="string">android:</span>paddingLeft=<span class="string">"@dimen/activity_horizontal_margin"</span></span><br><span class="line"><span class="label">    android:</span>paddingRight=<span class="string">"@dimen/activity_horizontal_margin"</span></span><br><span class="line"><span class="label">    android:</span>paddingTop=<span class="string">"@dimen/activity_vertical_margin"</span></span><br><span class="line"><span class="label">    android:</span>paddingBottom=<span class="string">"@dimen/activity_vertical_margin"</span> <span class="string">tools:</span>context=<span class="string">".MainActivity"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView <span class="string">android:</span>text=<span class="string">"@string/hello_world"</span> <span class="string">android:</span>layout_width=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">        android:</span>layout_height=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">        android:</span>id=<span class="string">"@+id/textView2"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line"><span class="label">        android:</span>layout_width=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">        android:</span>layout_height=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">        android:</span>text=<span class="string">"startMyAty"</span></span><br><span class="line"><span class="label">        android:</span>id=<span class="string">"@+id/btnStartMyAty"</span></span><br><span class="line"><span class="label">        android:</span>layout_below=<span class="string">"@+id/textView2"</span></span><br><span class="line"><span class="label">        android:</span>layout_toEndOf=<span class="string">"@+id/textView2"</span></span><br><span class="line"><span class="label">        android:</span>layout_marginTop=<span class="string">"81dp"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/RelativeLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>MyAty.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(<span class="type">R</span>.id.btnStartMyAty).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">                startActivity(<span class="keyword">new</span> <span class="type">Intent</span>(<span class="type">MainActivity</span>.<span class="keyword">this</span>,<span class="type">MyAty</span>.<span class="keyword">class</span>));<span class="comment">//这是一个显示的Intent,因为显示的写出了被启动的MyAty.class</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>myAty.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">LinearLayout</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">android:orientation</span>=<span class="value">"vertical"</span> <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">TextView</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"New Text"</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/textView"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">Button</span></span><br><span class="line">        <span class="attribute">android:layout_width</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:layout_height</span>=<span class="value">"wrap_content"</span></span><br><span class="line">        <span class="attribute">android:text</span>=<span class="value">"New Button"</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/button"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>MyAty.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.<span class="type">Activity</span>;</span><br><span class="line"><span class="keyword">import</span> android.os.<span class="type">Bundle</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by zhang on 2016/1/11.</span><br><span class="line"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyAty</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line">    <span class="comment">//重写oncreate函数</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.myaty);<span class="comment">//将这个activity与视图myaty绑定</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>androidmainfest.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">manifest</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    <span class="attribute">package</span>=<span class="value">"com.example.zhang.learnintent"</span> &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="title">application</span></span><br><span class="line">        <span class="attribute">android:allowBackup</span>=<span class="value">"true"</span></span><br><span class="line">        <span class="attribute">android:icon</span>=<span class="value">"@mipmap/ic_launcher"</span></span><br><span class="line">        <span class="attribute">android:label</span>=<span class="value">"@string/app_name"</span></span><br><span class="line">        <span class="attribute">android:theme</span>=<span class="value">"@style/AppTheme"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">            <span class="attribute">android:name</span>=<span class="value">".MainActivity"</span></span><br><span class="line">            <span class="attribute">android:label</span>=<span class="value">"@string/app_name"</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 注册MyAty,前面加一点是因为程序运行时会加直接在package="com.example.zhang.learnintent"后面 也可以com.example.zhang.learnintent.MyAty --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">activity</span> <span class="attribute">android:name</span>=<span class="value">".MyAty"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;activity android:name="com.example.zhang.learnintent.MyAty"/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">application</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>运行效果：点击按钮跳转到另外一个界面</p>
<p>(2)隐式 Intent<br>androidmainfest.xml中指定category，category为DEFAULT时，其行为方式为activity<br>action可以是任意的字符串，启动的时候根据字符串启动就可以啦，在main.java中用这个字符串（不能有中文）就可以<br>改动androidmainfest.xml和main.java，其他不变<br>androidmainfest.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span> <span class="attribute">android:name</span>=<span class="value">".MyAty"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.DEFAULT"</span>/&gt;</span><span class="comment">&lt;!-- android.intent.category.DEFAULT此处不能全部用大写 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"acdsndslvdjsldvms.a"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    startActivity(<span class="keyword">new</span> Intent(<span class="string">"acdsndslvdjsldvms.a"</span>));<span class="comment">//这是一个显示的Intent,因为显示的写出了被启动的MyAty.class</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行效果与上面的一样<br>但是上面用随意的字符串可读性太差，可以用约定成俗的格式com.zhang.LearnIntent.intent.action.MyAty,一看就知道启动哪个activity<br>这太长，还是很难记，一般在被启动的activity（MyAty.java）中添加常量</p>
<p>androidmainfest.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span> <span class="attribute">android:name</span>=<span class="value">".MyAty"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.DEFAULT"</span>/&gt;</span><span class="comment">&lt;!-- android.intent.category.DEFAULT此处不能全部用大写 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"com.zhang.LearnIntent.intent.action.MyAty"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>MyAty.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyAty</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    public static <span class="keyword">final</span> <span class="type">String</span> <span class="type">ACTION</span> = <span class="string">"com.zhang.LearnIntent.intent.action.MyAty"</span>;</span><br><span class="line">    <span class="comment">//重写oncreate函数</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.myaty);<span class="comment">//将这个activity与视图myaty绑定</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    startActivity(<span class="keyword">new</span> Intent(MyAty.ACTION));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行效果与上面的一样</p>
<p>不同应用间通过ACTION启动<br>再创建一个新的项目App1用new Module—在同一个界面显示<br>App1中：<br>Main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"Start MyAty from App1"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStartMyAty"</span></span><br><span class="line">    android:layout_below=<span class="string">"@+id/textView"</span></span><br><span class="line">    android:layout_alignParentStart=<span class="string">"true"</span></span><br><span class="line">    android:layout_marginTop=<span class="string">"52dp"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    findViewById(R.id.btnStartMyAty).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            startActivity(<span class="keyword">new</span> Intent(<span class="string">"com.zhang.LearnIntent.intent.action.MyAty"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通过软件App1可以启动跳转到LearnIntent的界面MyAty<br>如果不允许其他应用访问我应用的activity,只允许自己访问，该怎么配置呢？<br>只需要将该应用的activity的androidmainfest.xml进行如下配置，则其他应用不能访问这个activity<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity <span class="string">android:</span>name=<span class="string">".MyAty"</span> <span class="string">android:</span>exported=<span class="string">"false"</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>？？？但是不知道为啥，我的加了这个语句还是可以访问！</p>
<p>(3)Intent 过滤器相关选项<br>多个activity的intent一样会出现什么情况呢？<br>没有去掉MyAty的android:exported=”false”时，会直接显示MyAty1<br>去掉后会如下，让你自己选择<br><img src="/img/android/22.png" alt="image"><br>可以选择just once或者always<br>选择always后下次将默认启动这项，取消需要在设置里面弄<br>将软件LearnIntent拉到info里面，点击CLEAR DEFAULTS将默认设置都清掉，则可以重新选择（我的模拟器不行（清后还是默认的）—应该是安卓版本太低）<br><img src="/img/android/23.png" alt="image"><br>过滤器里面还有一个属性data<br>在MyAty1下加入data项如下<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">".MyAty1"</span></span><br><span class="line">    <span class="attribute">android:label</span>=<span class="value">"@string/title_activity_my_aty1"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"com.zhang.LearnIntent.intent.action.MyAty"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">data</span> <span class="attribute">android:scheme</span>=<span class="value">"app"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在APP1中如何找到指定的activity呢？<br>两个activity：MyAty是通过默认配置，而MyAty1是通过添加schme(指明的协议是”app”)<br>Data属性下还有很多常用的属性，自己下来看<br>App1-main.java中<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    startActivity(<span class="keyword">new</span> Intent(<span class="string">"com.zhang.LearnIntent.intent.action.MyAty"</span>, Uri.parse(<span class="string">"app://hello"</span>)));<span class="comment">// app://后面参数任意，不一定是hello</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如此，启动App1后点击按钮直接到MyAty1</p>
<p>(4) 通过浏览器链接启动本地 Activity<br>先建一个activity,再到再mainfest.xml下配置activity<br>Localaty.xml<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView <span class="string">android:</span>text=<span class="string">"这是浏览器链接的本地的activity"</span> <span class="string">android:</span>layout_width=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">    android:</span>layout_height=<span class="string">"wrap_content"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>mainfest.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">".LocalAty"</span></span><br><span class="line">    <span class="attribute">android:label</span>=<span class="value">"@string/title_activity_local_aty"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.BROWSABLE"</span>/&gt;</span>  <span class="comment">&lt;!-- 可以被浏览器启动配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.VIEW"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">data</span> <span class="attribute">android:scheme</span>=<span class="value">"app"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>配置完成后，写一个浏览器的页面——用软件WebStorm开发，当然也可以用任何html编辑软件<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">title</span>&gt;</span>App<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 调整文字的大小 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css"></span><br><span class="line">        <span class="tag">a</span><span class="rules">&#123;</span><br><span class="line">            <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">50pt</span></span></span>;</span><br><span class="line">        &#125;</span></span><br><span class="line">    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"app://hello"</span>&gt;</span>Launch My APP<span class="tag">&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>直接在电脑浏览器上无法访问到app,因为不能处理APP协议<br><img src="/img/android/24.png" alt="image"></p>
<p>在手机上打开：手机用本地地址：10.0.2.2<br>注意要加端口，地址全名：http：//10.0.2.2:63343/App/index.html<br>如下所示<br><img src="/img/android/25.png" alt="image"><br>如此实现了浏览器打开APP的activity,但是如何接收到参数呢？<br>通过（Android.net下的）Uri.可以获取信息<br><img src="/img/android/26.png" alt="image"><br>Localaty.java<br><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="component">protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">    super<span class="string">.onCreate(savedInstanceState)</span>;</span><br><span class="line">    setContentView(R<span class="string">.layout.activity_local_aty)</span>;</span><br><span class="line"></span><br><span class="line">    Uri uri = getIntent()<span class="string">.getData()</span>;</span><br><span class="line">    System<span class="string">.out.println(uri)</span>;// System<span class="string">.out.print(uri)会由于缓存原因没有输出，所以用println</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>安装APP，打开网页点击打开activity,输出信息：<br><img src="/img/android/27.png" alt="image"></p>
<h2 id="6-Android__u4E2D_Context__u7684_u7406_u89E3_u53CA_u4F7F_u7528"><a href="#6-Android__u4E2D_Context__u7684_u7406_u89E3_u53CA_u4F7F_u7528" class="headerlink" title="6.Android 中 Context 的理解及使用"></a>6.Android 中 Context 的理解及使用</h2><p>Context 是 Android 中一个非常重要的概念，用于访问全局信息，几乎所有的基础组件都继承自 Context，理解 Context 对于学习 Android 四大基本组件非常有帮助。<br>核心内容：理解 Context;理解 Application<br>(1) Context 的作用<br>Context:用于访问全局信息（如用于程序的资源：图片，字符串）的接口，如activity也是继承自Context<br>那么如何通过context进行资源的访问呢？<br><img src="/img/android/28.png" alt="image"><br>TextView里面最少要有一个context.而activity继承自context,所以可以用activity<br>Main.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">TextView</span> tv;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"><span class="comment">//        setContentView(R.layout.activity_main);</span></span><br><span class="line">        tv = <span class="keyword">new</span> <span class="type">TextView</span>(<span class="type">MainActivity</span>.<span class="keyword">this</span>);<span class="comment">//不是内部类，MainActivity.this可以直接用this</span></span><br><span class="line">        tv.setText(<span class="string">"hello android"</span>);</span><br><span class="line">        setContentView(tv);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行输出字符串hello android<br>可以获取任意的字符串资源如<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tv.setText(R.<span class="keyword">string</span>.app_name);//app_name在<span class="keyword">string</span>.xml中，为LearnContext</span><br></pre></td></tr></table></figure></p>
<p>图片资源<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ImageView iv = new ImageView(this)<span class="comment">;</span></span><br><span class="line">iv.setImageResource(R.mipmap.ic_launcher)<span class="comment">;</span></span><br><span class="line">setContentView(iv)<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>运行如下：<br><img src="/img/android/29.png" alt="image"></p>
<p>(2)Application 的用途<br>信息共享<br>创建一个类APP继承自Application<br>之后打开androidmainfest.xml配置<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="type">application</span></span><br><span class="line">    android:<span class="property">name</span>=<span class="string">".App"</span></span><br></pre></td></tr></table></figure></p>
<p>如此则自定义了一个安卓的Application, Application才是一个真正的全局上下文对象<br>在main.java中通过getApplicationContext()就可以获取到Application的全局的对象<br>下面实现一个全局共享的数据<br>App.java中写一个字符串，在为他写一个set,get方法，代码如下<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.<span class="type">Application</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by zhang on 2016/1/12.</span><br><span class="line"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Application</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> textdata = <span class="string">"default"</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="type">String</span> getTextdata() &#123;</span><br><span class="line">        <span class="keyword">return</span> textdata;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTextdata(<span class="type">String</span> textdata) &#123;</span><br><span class="line">        <span class="keyword">this</span>.textdata = textdata;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>新建一个main2.java继承自activity<br>重写oncreate函数<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> android.app.<span class="type">Activity</span>;</span><br><span class="line"><span class="keyword">import</span> android.os.<span class="type">Bundle</span>;</span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by zhang on 2016/1/12.</span><br><span class="line"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Main2</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>打开androidmainfest.xml添加上这个activity<br>复制mainactivity的配置让这个activity也是默认启动(category.LAUNCHER)<br>Label一个设置main1,一个main2<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">".MainActivity"</span></span><br><span class="line">    <span class="attribute">android:label</span>=<span class="value">"Main1"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">activity</span> <span class="attribute">android:name</span>=<span class="value">".Main2"</span> <span class="attribute">android:label</span>=<span class="value">"Main2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.LAUNCHER"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>安装后发现有两个软件，一个main1启动的是main1，另一个main2启动的是main2<br>下面让他们实现数据共享<br>新建linearlayout,如下main1,main2，删掉原来的mainactivity.xml<br><img src="/img/android/30.png" alt="image"><br>两个activity分别绑定两个视图<br>Mainactivity.java<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">setContentView</span>(<span class="tag">R</span><span class="class">.layout</span><span class="class">.main1</span>);</span><br></pre></td></tr></table></figure></p>
<p>main2.java<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">setContentView</span>(<span class="tag">R</span><span class="class">.layout</span><span class="class">.main2</span>);</span><br></pre></td></tr></table></figure></p>
<p>main1.activity中放入输出输入文本框和按钮，main2.activity与main1相同<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"New Text"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/textView"</span></span><br><span class="line">    android:layout_weight=<span class="string">"0.03"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;EditText</span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/editText"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"保存"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnSave"</span></span><br><span class="line">    android:layout_weight=<span class="string">"0.03"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>保存和读取Application数据中的信息<br>Mainactivity.java与main2.java一样<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Main2</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">TextView</span> textView;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">EditText</span> editText;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.main2);</span><br><span class="line">        textView = (<span class="type">TextView</span>) findViewById(<span class="type">R</span>.id.textView);</span><br><span class="line">        editText = (<span class="type">EditText</span>) findViewById(<span class="type">R</span>.id.editText);</span><br><span class="line">        textView.setText(<span class="string">"共享的数据是："</span> + getApp().getTextdata());</span><br><span class="line"></span><br><span class="line">        findViewById(<span class="type">R</span>.id.btnSave).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">                ((<span class="type">App</span>) getApplicationContext()).setTextdata(editText.getText().toString());</span><br><span class="line">                textView.setText(<span class="string">"共享的数据是："</span> + editText.getText().toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="type">App</span> getApp() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">App</span>) getApplicationContext();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>main1运行：点击输入保存看到共享的数据<br><img src="/img/android/31.png" alt="image"><br>退出main1打开main2如下：成功读取数据，同样，在main2中改的在main1中可以收到<br><img src="/img/android/32.png" alt="image"></p>
<p>(3) Application 生命周期<br>App.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String textdata = <span class="string">"default"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTextdata</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> textdata;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTextdata</span><span class="params">(String textdata)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.textdata = textdata;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span><span class="comment">//创建</span></span><br><span class="line">    <span class="comment">//比被启动的activity的oncreate先执行--方便做一些初始化操作</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        System.out.println(<span class="string">"App oncreate()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span><span class="comment">//结束----一般情况不执行，只是模拟情况下执行</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTerminate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onTerminate();</span><br><span class="line">        System.out.println(<span class="string">"App onTerminate()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span><span class="comment">//低内存时执行</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLowMemory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLowMemory();</span><br><span class="line">        System.out.println(<span class="string">"App onlowmemory()"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span><span class="comment">//程序进行内存清理时执行</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTrimMemory</span><span class="params">(<span class="keyword">int</span> level)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onTrimMemory(level);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span><span class="comment">//配置改变时执行</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConfigurationChanged</span><span class="params">(Configuration newConfig)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onConfigurationChanged(newConfig);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>mainactivity.java<br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.<span class="keyword">out</span>.println(<span class="string">"mainactivity oncreate()"</span>);</span><br></pre></td></tr></table></figure></p>
<p>Main2.java<br><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.<span class="keyword">out</span>.println(<span class="string">"main2 oncreate()"</span>);</span><br></pre></td></tr></table></figure></p>
<p>运行：不管启动哪个activity，app.java的oncreate函数先会执行<br><img src="/img/android/33.png" alt="image"><br>关闭main1后（不然好像不会再次启动app.java的oncreate函数）启动main2<br><img src="/img/android/34.png" alt="image"></p>
<h2 id="7-_u8BA4_u8BC6_Android_Service"><a href="#7-_u8BA4_u8BC6_Android_Service" class="headerlink" title="7.认识 Android Service"></a>7.认识 Android Service</h2><p>课程背景：Service 是 Android 四大基本组件之一，是无界面的应用程序，可以长期在后台运行，在实际工作中非常重要，比如接收推送消息、在锁屏状态下侦听传感器信息。<br>核心内容：启动Service;绑定Service</p>
<p>(1) 使用 Service<br>新建一个项目learnservice<br>Java包下new-&gt;server-&gt;server 产生myserver.java<br>Exported:是否导出（向外界公开）   enabled：是否启用<br>如何启用呢？<br>myserver.java没动<br>Main.xml加入按钮<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStartService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"停止服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnEndService"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Intent</span> intent;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(<span class="type">R</span>.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        intent = <span class="keyword">new</span> <span class="type">Intent</span>(<span class="type">MainActivity</span>.<span class="keyword">this</span>,<span class="type">MyService</span>.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">        findViewById(<span class="type">R</span>.id.btnStartService).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">               <span class="comment">// startService(new Intent(MainActivity.this, MyService.class));//启动服务</span></span><br><span class="line">                startService(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        findViewById(<span class="type">R</span>.id.btnEndService).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">               <span class="comment">// stopService(new Intent(MainActivity.this,MyService.class));//服务的操作在一个实例中只有一个，停止的是上面启动的</span></span><br><span class="line">                stopService(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>启动运行：<br>运行先不操作，按中间键进入桌面，查看setting-&gt;APPS（应用）-&gt;running(所有正在运行的程序) 能够看到正在运行的服务<br>点击按钮开始，再到上面地方看，发现多了一个这个项目的service（一个进程，一个服务）<br>点击停止服务，发现服务没有了</p>
<p>写一个实例：让他不断的在后台输出语句<br>Myservice.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="comment">//外界执行startservice后会执行这个函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个线程，让他不断输出语句</span></span><br><span class="line">    <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.run();</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">"服务正在运行..."</span>);</span><br><span class="line">                <span class="comment">//休眠1S</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.start();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行点击启动服务<br>每隔1s后台不断输出 服务正在运行…<br>按左边个键退出程序服务仍然执行</p>
<p>(2) 绑定 Service<br>Main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStartService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"停止服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnEndService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"绑定服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnBindService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"解除绑定服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnUnbindService"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// implements View.OnClickListener------实现接口后可以把</span></span><br><span class="line"><span class="comment">//findViewById(R.id.btnStartService).setOnClickListener(new View.OnClickListener() &#123;</span></span><br><span class="line"><span class="comment">//@Override</span></span><br><span class="line"><span class="comment">//public void onClick(View v) &#123;</span></span><br><span class="line"><span class="comment">//        // startService(new Intent(MainActivity.this, MyService.class));//启动服务</span></span><br><span class="line"><span class="comment">//        startService(intent);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"><span class="comment">//改为 findViewById(R.id.btnBindService).setOnClickListener(this);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>, <span class="title">ServiceConnection</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Intent intent;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,MyService.class);</span><br><span class="line">        findViewById(R.id.btnStartService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnEndService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnBindService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnUnbindService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStartService:</span><br><span class="line">                startService(intent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnEndService:</span><br><span class="line">                stopService(intent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnBindService:</span><br><span class="line">                bindService(intent,<span class="keyword">this</span>, Context.BIND_AUTO_CREATE);<span class="comment">//bindService(intent；服务连接:听服务状态。让this实现监听service，同时实现下面两个函数；常量);</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnUnbindService:</span><br><span class="line">                unbindService(<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="comment">//标识服务连接成功</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Service connected!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>Myservice.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Return the communication channel to the service.</span></span><br><span class="line">       <span class="comment">// throw new UnsupportedOperationException("Not yet implemented");</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Binder();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="comment">//外界执行startservice后会执行这个函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个线程，让他不断输出语句</span></span><br><span class="line">        <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line">                <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"服务正在运行..."</span>);</span><br><span class="line">                    <span class="comment">//休眠1S</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行<br>点击绑定服务：输出Service connected!<br>点击解除绑定则解除绑定<br>注意：点击如下打印机上面那个按钮，System.out.println()才在后台显示输出<br><img src="/img/android/35.png" alt="image"></p>
<p>(3) Service生命周期<br>public int onStartCommand(Intent intent, int flags, int startId)<br>public void onCreate()<br>public void onDestroy()<br>myservice.java如下：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Return the communication channel to the service.</span></span><br><span class="line">       <span class="comment">// throw new UnsupportedOperationException("Not yet implemented");</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Binder();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="comment">//外界执行startservice后会执行这个函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个线程，让他不断输出语句</span></span><br><span class="line"><span class="comment">//        new Thread()&#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public void run() &#123;</span></span><br><span class="line"><span class="comment">//                super.run();</span></span><br><span class="line"><span class="comment">//                while(true) &#123;</span></span><br><span class="line"><span class="comment">//                    System.out.println("服务正在运行...");</span></span><br><span class="line"><span class="comment">//                    //休眠1S</span></span><br><span class="line"><span class="comment">//                    try &#123;</span></span><br><span class="line"><span class="comment">//                        sleep(1000);</span></span><br><span class="line"><span class="comment">//                    &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">//                        e.printStackTrace();</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;.start();</span></span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        System.out.println(<span class="string">"service oncreate"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        System.out.println(<span class="string">"service ondestroy"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br><img src="/img/android/36.png" alt="image"><br>点击启动服务 输出service oncreate<br>点击停止服务 输出service ondestroy<br>再点击绑定服务 输出service oncreate   Service connected!<br>点击解除绑定服务 输出service ondestroy<br>同时点击启动绑定服务后，单独点击解除绑定服务或者停止服务没有反应，必须点击解除绑定和停止两个服务才会退出<br>点击启动服务，点击手机左键退出程序，服务仍然运行<br>点击停止服务才退出<br>点击绑定服务，点击手机左键退出程序，抛出一个异常后服务退出（说明绑定在程序退出后解除绑定）</p>
<p>Myservice修改如下：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个线程，让他不断输出语句</span></span><br><span class="line"><span class="comment">//        new Thread()&#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public void run() &#123;</span></span><br><span class="line"><span class="comment">//                super.run();</span></span><br><span class="line"><span class="comment">//                while(true) &#123;</span></span><br><span class="line"><span class="comment">//                    System.out.println("服务正在运行...");</span></span><br><span class="line"><span class="comment">//                    //休眠1S</span></span><br><span class="line"><span class="comment">//                    try &#123;</span></span><br><span class="line"><span class="comment">//                        sleep(1000);</span></span><br><span class="line"><span class="comment">//                    &#125; catch (InterruptedException e) &#123;</span></span><br><span class="line"><span class="comment">//                        e.printStackTrace();</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;.start();</span></span><br><span class="line">        System.out.println(<span class="string">"service onStartCommand"</span>);</span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        System.out.println(<span class="string">"service oncreate"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        System.out.println(<span class="string">"service ondestroy"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br>启动服务：service oncreate，service onStartCommand。<br>一直点击启动服务，此时oncreate不在执行<br>重复执行启动服务一直输出：service onStartCommand</p>
<p>修改myservice：<br>控制服务的开始于停止<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> serviceRunning = <span class="keyword">false</span>;<span class="comment">//标识</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Return the communication channel to the service.</span></span><br><span class="line">       <span class="comment">// throw new UnsupportedOperationException("Not yet implemented");</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Binder();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="comment">//外界执行startservice后会执行这个函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"service onStartCommand"</span>);</span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        System.out.println(<span class="string">"service oncreate"</span>);</span><br><span class="line">        serviceRunning=<span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">//创建一个线程，让他不断输出语句</span></span><br><span class="line">        <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line">                <span class="keyword">while</span>(serviceRunning) &#123;</span><br><span class="line">                    System.out.println(<span class="string">"服务正在运行..."</span>);</span><br><span class="line">                    <span class="comment">//休眠1S</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        System.out.println(<span class="string">"service ondestroy"</span>);</span><br><span class="line">        serviceRunning=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br>启动服务：<br>service oncreate<br>service onStartCommand<br>服务正在运行…<br>服务正在运行…<br>服务正在运行…<br>服务正在运行…</p>
<p>停止服务：<br>service ondestroy</p>
<p>绑定服务：<br>service oncreate<br>服务正在运行…<br>Service connected!<br>服务正在运行…<br>服务正在运行…<br>服务正在运行…<br>服务正在运行…</p>
<p>解除绑定服务：<br>service ondestroy</p>
<h2 id="8-Android__u4E2D_Service__u901A_u4FE1"><a href="#8-Android__u4E2D_Service__u901A_u4FE1" class="headerlink" title="8.Android 中 Service 通信"></a>8.Android 中 Service 通信</h2><p>核心内容：绑定Service并与之通信<br>(1) 启动 Service 并传递数据<br>外界与一个服务实现数据传递<br>Main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span> android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">   android:orientation=<span class="string">"vertical"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span> android:paddingLeft=<span class="string">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    android:paddingRight=<span class="string">"@dimen/activity_horizontal_margin"</span></span><br><span class="line">    android:paddingTop=<span class="string">"@dimen/activity_vertical_margin"</span></span><br><span class="line">    android:paddingBottom=<span class="string">"@dimen/activity_vertical_margin"</span> tools:context=<span class="string">".MainActivity"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:<span class="type">text</span>=<span class="string">"默认信息"</span></span><br><span class="line">        android:<span class="property">id</span>=<span class="string">"@+id/etData"</span>/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:<span class="type">text</span>=<span class="string">"启动服务"</span></span><br><span class="line">        android:<span class="property">id</span>=<span class="string">"@+id/btnStartService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:<span class="type">text</span>=<span class="string">"停止服务"</span></span><br><span class="line">        android:<span class="property">id</span>=<span class="string">"@+id/btnStopService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EditText editText;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        editText= (EditText) findViewById(R.id.etData);</span><br><span class="line">        findViewById(R.id.btnStartService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnStopService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">        <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">        <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">        <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onOptionsItemSelected</span><span class="params">(item)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStartService:</span><br><span class="line">                Intent i=<span class="keyword">new</span> Intent(<span class="keyword">this</span>,MyService.class);</span><br><span class="line">                i.putExtra(<span class="string">"data"</span>,editText.getText().toString());<span class="comment">//直接把data放到intent传递给service-----service中onstartcommand中第一个参数就是接收的intent</span></span><br><span class="line">                startService(i);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStopService:</span><br><span class="line">                stopService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>,MyService.class));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Service.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> running=<span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> String data=<span class="string">"这是默认信息"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Return the communication channel to the service.</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Not yet implemented"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        data=intent.getStringExtra(<span class="string">"data"</span>);</span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        running=<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line">                <span class="keyword">while</span> (running)&#123;</span><br><span class="line">                    System.out.println(data);<span class="comment">/////////////</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        running=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br>点击启动服务输出：默认信息<br>改变输入框内信息再点击启动服务：后台输出信息发生变化，和输入框内一样<br>停止服务：输出停止</p>
<p>(2) 绑定 Service 进行通信（上）<br>本课时讲解如何与被绑定的 Service 进行通信<br>Main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditText</span><br><span class="line">    android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"默认信息"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/etData"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStartService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"停止服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStopService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"绑定服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnBindservice"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"解除绑定服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnUnbindservice"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"同步数据"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnSyncData"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>, <span class="title">ServiceConnection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EditText editText;</span><br><span class="line">    <span class="keyword">private</span> MyService.Binder binder = <span class="keyword">null</span>;<span class="comment">//定义一个Binder对象</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        editText= (EditText) findViewById(R.id.etData);</span><br><span class="line">        findViewById(R.id.btnStartService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnStopService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnBindservice).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnUnbindservice).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnSyncData).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">        <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">        <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">        <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onOptionsItemSelected</span><span class="params">(item)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStartService:</span><br><span class="line">                Intent i=<span class="keyword">new</span> Intent(<span class="keyword">this</span>,MyService.class);</span><br><span class="line">                i.putExtra(<span class="string">"data"</span>,editText.getText().toString());<span class="comment">//直接把data放到intent传递给service-----service中onstartcommand中第一个参数就是接收的intent</span></span><br><span class="line">                startService(i);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStopService:</span><br><span class="line">                stopService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.class));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnBindservice:</span><br><span class="line">                bindService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.class),<span class="keyword">this</span>, Context.BIND_AUTO_CREATE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnUnbindservice:</span><br><span class="line">                unbindService(<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnSyncData:</span><br><span class="line">                <span class="keyword">if</span>(binder != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    binder.setData(editText.getText().toString());<span class="comment">//从输入框内传入数据---这种方法比直接方法调用，比Intent那种方法快得多</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="comment">//这里参数IBinder service是myservice中传来</span></span><br><span class="line">    <span class="comment">//访问到的是myservice中 public IBinder onBind(Intent intent)的的返回值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">        binder= (MyService.Binder) service;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>myservice.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> running=<span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> String data=<span class="string">"这是默认信息"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Binder();<span class="comment">//自己建的</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个类继承来自系统的Binder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Binder</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">os</span>.<span class="title">Binder</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">            MyService.<span class="keyword">this</span>.data=data;<span class="comment">//修改data值</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        data=intent.getStringExtra(<span class="string">"data"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        running=<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line">                <span class="keyword">while</span> (running)&#123;</span><br><span class="line">                    System.out.println(data);<span class="comment">/////////////</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        running=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行程序：<br>点击绑定服务：输出：这是默认信息<br>改变输入框内容，点击同步数据：后台输出内容与输入框内容一样</p>
<p>(3) 绑定 Service 进行通信（下）<br>本课时讲解如何侦听被绑定的 Service 的内部状态<br>如服务内部发生改变后发送到界面<br>Callback回调<br>Main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/tvOut"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;EditText</span><br><span class="line">    android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"默认信息"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/etData"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStartService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"停止服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStopService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"绑定服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnBindservice"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"解除绑定服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnUnbindservice"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"同步数据"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnSyncData"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>, <span class="title">ServiceConnection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TextView tvOut;</span><br><span class="line">    <span class="keyword">private</span> EditText editText;</span><br><span class="line">    <span class="keyword">private</span> MyService.Binder binder = <span class="keyword">null</span>;<span class="comment">//定义一个Binder对象</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        tvOut= (TextView) findViewById(R.id.tvOut);</span><br><span class="line">        editText= (EditText) findViewById(R.id.etData);</span><br><span class="line">        findViewById(R.id.btnStartService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnStopService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnBindservice).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnUnbindservice).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnSyncData).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">        <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">        <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">        <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onOptionsItemSelected</span><span class="params">(item)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStartService:</span><br><span class="line">                Intent i=<span class="keyword">new</span> Intent(<span class="keyword">this</span>,MyService.class);</span><br><span class="line">                i.putExtra(<span class="string">"data"</span>,editText.getText().toString());<span class="comment">//直接把data放到intent传递给service-----service中onstartcommand中第一个参数就是接收的intent</span></span><br><span class="line">                startService(i);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStopService:</span><br><span class="line">                stopService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.class));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnBindservice:</span><br><span class="line">                bindService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyService.class),<span class="keyword">this</span>, Context.BIND_AUTO_CREATE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnUnbindservice:</span><br><span class="line">                unbindService(<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnSyncData:</span><br><span class="line">                <span class="keyword">if</span>(binder != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    binder.setData(editText.getText().toString());<span class="comment">//从输入框内传入数据---这种方法比直接方法调用，比Intent那种方法快得多</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="comment">//这里参数IBinder service是myservice中传来</span></span><br><span class="line">    <span class="comment">//访问到的是myservice中 public IBinder onBind(Intent intent)的的返回值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">        binder= (MyService.Binder) service;</span><br><span class="line">        <span class="comment">//访问回调函数</span></span><br><span class="line">        binder.getService().setCallback(<span class="keyword">new</span> MyService.Callback() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDataChange</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//UI线程是不允许其他辅线程来修改UI线程的资源</span></span><br><span class="line"><span class="comment">//                tvOut.setText(data);//错误-------------因为程序是由myservice中新创建的线程来调用的，直接用一个新创建的线程来执行UI线程的资源是不能成功运行的</span></span><br><span class="line">                <span class="comment">//再下面新创建一个Handler</span></span><br><span class="line">                Message msg = <span class="keyword">new</span> Message();</span><br><span class="line">                Bundle b=<span class="keyword">new</span> Bundle();</span><br><span class="line">                b.putString(<span class="string">"data"</span>,data);</span><br><span class="line">                <span class="comment">//通过msg附加上一个数据</span></span><br><span class="line">                msg.setData(b);</span><br><span class="line">                <span class="keyword">handler</span>.sendMessage(msg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新创建一个Handler</span></span><br><span class="line">    <span class="comment">//用android.os.Handler类而不是java库中Handler类</span></span><br><span class="line">    <span class="keyword">private</span> android.os.Handler <span class="keyword">handler</span> = <span class="keyword">new</span> android.os.Handler()&#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>.handleMessage(msg);</span><br><span class="line">            <span class="comment">//获取字符串</span></span><br><span class="line">           tvOut.setText(msg.getData().getString(<span class="string">"data"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>myservice.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> running=<span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> String data=<span class="string">"这是默认信息"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Binder();<span class="comment">//自己建的</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个类继承来自系统的Binder</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Binder</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">os</span>.<span class="title">Binder</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">            MyService.<span class="keyword">this</span>.data=data;<span class="comment">//修改data值</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//回调函数事件绑定</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> MyService <span class="title">getService</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span> MyService.<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        data=intent.getStringExtra(<span class="string">"data"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        running=<span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (running)&#123;</span><br><span class="line">                    i++;</span><br><span class="line">                    String str=i+<span class="string">":"</span>+data;</span><br><span class="line">                    System.out.println(str);<span class="comment">/////////////</span></span><br><span class="line">                    <span class="keyword">if</span>(callback != <span class="keyword">null</span>)&#123;</span><br><span class="line">                        callback.onDataChange(str);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        running=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Callback callback = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCallback</span><span class="params">(Callback callback)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.callback = callback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Callback <span class="title">getCallback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> callback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">interface</span> <span class="title">Callback</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onDataChange</span><span class="params">(String data)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：点击绑定服务  开始不断累加显示数字—-信息是从myservice中传来的<br><img src="/img/android/37.png" alt="image"></p>
<h2 id="9-Android__u4E2D_AIDL__u7684_u7406_u89E3_u4E0E_u4F7F_u7528"><a href="#9-Android__u4E2D_AIDL__u7684_u7406_u89E3_u4E0E_u4F7F_u7528" class="headerlink" title="9.Android 中 AIDL 的理解与使用"></a>9.Android 中 AIDL 的理解与使用</h2><p>(1) 跨应用启动 Service<br>Appservice.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate();</span><br><span class="line">    System.out.println(<span class="string">"service started"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    System.out.println(<span class="string">"service ondestroyed"</span>);</span><br></pre></td></tr></table></figure></p>
<p>main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    startService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>,Appservice.class));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    stopService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, Appservice.class));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行程序，后台输出service started，退出程序，后台输出service ondestroyed<br>在同一个程序中通过startService(new Intent(this,Appservice.class)); stopService(new Intent(this, Appservice.class));启动停止服务简单，那么如何通过其他程序来启动停止这个服务呢？<br>再创建一个名字为AnotherApp的module<br>备注：Android5.0以前可以使用隐式Intent（前面有讲到用他启动另外一个APP的activity）, Android5.0之后只能使用显式Intent<br>AnotherApp.main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStartAppService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"停止服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStopAppService"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>AnotherApp.main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Intent serviceIntent;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.btnStartAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnStopAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        serviceIntent=<span class="keyword">new</span> Intent();</span><br><span class="line">        <span class="comment">//如下显示Intent</span></span><br><span class="line">        <span class="comment">//通过setComponent显示指明要启动的Intent</span></span><br><span class="line"><span class="comment">//                new ComponentName(被启动的Intent所在包名，被启动的类名)</span></span><br><span class="line">        serviceIntent.setComponent(<span class="keyword">new</span> ComponentName(<span class="string">"com.example.zhang.startservicefromanotherapp"</span>,<span class="string">"com.example.zhang.startservicefromanotherapp.Appservice"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStartAppService:</span><br><span class="line">                startService(serviceIntent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStopAppService:</span><br><span class="line">                stopService(serviceIntent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br>点击启动服务，在被启动项目下的后台（StartservicefromanotherAPP）（注意：不是AnotherApp）可以看到启动输出：service started</p>
<p>也可以在Appservice内部重写onStartCommand用于接收从其他的应用传过来的数据<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> onStartCommand(<span class="type">Intent</span> <span class="type">intent</span>, <span class="built_in">int</span> flags, <span class="built_in">int</span> startId)&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>(2) 跨应用绑定 Service<br>绑定时需要用到一个bundler，一个程序无法访问另外一个程序中类的定义，那么是否不能通信呢？<br>Android提供了一种机制用于多个程序之间通信：AIDL（Android Interface Definition Language/ Android接口定义语言），下面进行操作<br>创建一个AIDL文件<br>App下java包下New-&gt;AIDL-&gt;AIDL file（IAppServiceInterface），会生成一个.aidl文件，里面会自动生成对应的一个类IAppServiceInterface<br>这时候点击build-&gt;rebuild project重构一下（以便检测到刚刚生成的类），如此在service的public IBinder onBind(Intent intent)函数中可以直接返回这个类<br>Myservice.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Appservice</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Appservice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IAppServiceInterface.Stub()&#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat, <span class="keyword">double</span> aDouble, String aString)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        System.out.println(<span class="string">"service started"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        System.out.println(<span class="string">"service ondestroyed"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>如何通过AnotherApp绑定这个服务呢？<br>AnotherApp.main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动外部服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStartAppService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"停止外部服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStopAppService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"绑定外部服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnBindAppService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"解除绑定外部服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnUnbindAppService"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>AnotherApp.main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>, <span class="title">ServiceConnection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Intent serviceIntent;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.btnStartAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnStopAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnBindAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnUnbindAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        serviceIntent=<span class="keyword">new</span> Intent();</span><br><span class="line">        <span class="comment">//如下显示Intent</span></span><br><span class="line">        <span class="comment">//通过setComponent显示指明要启动的Intent</span></span><br><span class="line"><span class="comment">//                new ComponentName(被启动的Intent所在包名，被启动的类名)</span></span><br><span class="line">        serviceIntent.setComponent(<span class="keyword">new</span> ComponentName(<span class="string">"com.example.zhang.startservicefromanotherapp"</span>,<span class="string">"com.example.zhang.startservicefromanotherapp.Appservice"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStartAppService:</span><br><span class="line">                startService(serviceIntent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStopAppService:</span><br><span class="line">                stopService(serviceIntent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnBindAppService:</span><br><span class="line">                bindService(serviceIntent, <span class="keyword">this</span>, Context.BIND_AUTO_CREATE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnUnbindAppService:</span><br><span class="line">                unbindService(<span class="keyword">this</span>);<span class="comment">//注意，这里区别于上面三个，用this</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//bindService(serviceIntent, this, Context.BIND_AUTO_CREATE);中this需要下面两个函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Bind service"</span>);</span><br><span class="line">        System.out.println(service);<span class="comment">//看一下传入的IBinder是啥东西</span></span><br><span class="line"><span class="comment">// android.os.BinderProxy@c5151c7</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>先安装上App，再运行AnotherApp<br>点击绑定服务，App后台输出启动服务，AnotherApp后台输出Bind service android.os.BinderProxy@c5151c7</p>
<p>(3) 跨应用绑定 Service 并通信<br>修改aidl,添加接口</p>
<p>同步如何使用呢？<br>需要在另外一个APP下创建一个与原APP包含.aidl文件的相同包名和对应包下放相同的.aidl文件<br>创建过程：右键-&gt;new-&gt;Folder-&gt; AIDL Folder-&gt;finish<br>之后发现多出一个AIDL文件夹，右键-&gt;new-&gt;package(名字与原APP的.aidl文件包名同)<br>把.aidl文件复制到这个包下面就可以<br>现在两个应用有同样的.aidl文件，可以定义同样的定义</p>
<p>IAppServiceInterface.aidl<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title">IAppServiceInterface</span> &#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Demonstrates some basic types that you can use as parameters</span><br><span class="line">     * and return values in AIDL.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">basicTypes</span>(<span class="params"><span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, boolean aBoolean, <span class="keyword">float</span> aFloat,</span><br><span class="line">            <span class="keyword">double</span> aDouble, String aString</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setData</span>(<span class="params">String data</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>App.appservice.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Appservice</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置一个默认数据，通过另外一个App更改</span></span><br><span class="line">    <span class="keyword">private</span> String data=<span class="string">"默认数据"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> running=<span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Appservice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function">IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IAppServiceInterface.Stub()&#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat, <span class="keyword">double</span> aDouble, String aString)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setData</span><span class="params">(String data)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</span><br><span class="line">            Appservice.<span class="keyword">this</span>.data=data;<span class="comment">//对数据进行修改</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        System.out.println(<span class="string">"service started"</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread()&#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line">                running=<span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">while</span> (running)&#123;</span><br><span class="line">                    System.out.println(data);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        System.out.println(<span class="string">"service ondestroyed"</span>);</span><br><span class="line">        running=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>App.main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    startService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>,Appservice.class));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    stopService(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, Appservice.class));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Anotherapp.main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动外部服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStartAppService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"停止外部服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStopAppService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"绑定外部服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnBindAppService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"解除绑定外部服务"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnUnbindAppService"</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;EditText</span><br><span class="line">    android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"这是另外一个应用的数据"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/etInput"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"同步数据到绑定服务中"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnSync"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Another.main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span>, <span class="title">ServiceConnection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Intent serviceIntent;</span><br><span class="line">    <span class="keyword">private</span> EditText etInput;</span><br><span class="line">    <span class="keyword">private</span> IAppServiceInterface binder=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        etInput= (EditText) findViewById(R.id.etInput);</span><br><span class="line">        findViewById(R.id.btnStartAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnStopAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnBindAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnUnbindAppService).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnSync).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        serviceIntent=<span class="keyword">new</span> Intent();</span><br><span class="line">        <span class="comment">//如下显示Intent</span></span><br><span class="line">        <span class="comment">//通过setComponent显示指明要启动的Intent</span></span><br><span class="line"><span class="comment">//                new ComponentName(被启动的Intent所在包名，被启动的类名)</span></span><br><span class="line">        serviceIntent.setComponent(<span class="keyword">new</span> ComponentName(<span class="string">"com.example.zhang.startservicefromanotherapp"</span>,<span class="string">"com.example.zhang.startservicefromanotherapp.Appservice"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStartAppService:</span><br><span class="line">                startService(serviceIntent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnStopAppService:</span><br><span class="line">                stopService(serviceIntent);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnBindAppService:</span><br><span class="line">                bindService(serviceIntent, <span class="keyword">this</span>, Context.BIND_AUTO_CREATE);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnUnbindAppService:</span><br><span class="line">                unbindService(<span class="keyword">this</span>);<span class="comment">//注意，这里区别于上面三个，用this</span></span><br><span class="line">                binder=<span class="keyword">null</span>;<span class="comment">//解除绑定后要清空</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnSync:</span><br><span class="line">                <span class="keyword">if</span>(binder!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    <span class="comment">//远程通信异常</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        binder.setData(etInput.getText().toString());</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//bindService(serviceIntent, this, Context.BIND_AUTO_CREATE);中this需要下面两个函数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Bind service"</span>);</span><br><span class="line">        System.out.println(service);<span class="comment">//看一下传入的IBinder是啥东西</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        binder = (IAppServiceInterface) service;//错误 虽然两个应用中类的名字一样，但具体所在的内存地址不一样</span></span><br><span class="line">        binder=IAppServiceInterface.Stub.asInterface(service);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>安装APP后再运行AnotherApp<br>绑定外部服务，APP后台会输出“默认信息”，点击同步后与App中输入框的相同</p>
<h2 id="10-Android__u5E7F_u64AD_u63A5_u6536_u5668_BroadcastReceiver"><a href="#10-Android__u5E7F_u64AD_u63A5_u6536_u5668_BroadcastReceiver" class="headerlink" title="10.Android 广播接收器 BroadcastReceiver"></a>10.Android 广播接收器 BroadcastReceiver</h2><p>BroadcastReceiver 是Android 四大基本组件之一，用于接收广播信息，如：开屏、锁屏、短信等等，在实际工作中用途非常广泛<br>核心内容：动态注册和注销 BroadcastReceiver</p>
<p>(1) 使用 BroadcastReceiver<br>首先创建一个项目，再创建一个BroadcastReceiver：new-&gt;other-&gt; Broadcast Receiver<br>生成一个.java,可以在onReceive（）方法里面写语句<br>Receiver的子标签在fest.xml自动添加<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">receiver</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">".MyReceiver"</span></span><br><span class="line">    <span class="attribute">android:enabled</span>=<span class="value">"true"</span></span><br><span class="line">    <span class="attribute">android:exported</span>=<span class="value">"true"</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"发送消息"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnSendMsg"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="keyword">implements</span> <span class="title">View</span>.<span class="title">OnClickListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.btnSendMsg).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId())&#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnSendMsg:</span><br><span class="line">                sendBroadcast(<span class="keyword">new</span> Intent(<span class="keyword">this</span>,MyReceiver.class));<span class="comment">//发送广播消息</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>MyReceiver.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyReceiver</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">BroadcastReceiver</span> &#123;</span></span><br><span class="line">    public <span class="type">MyReceiver</span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="comment">//这里创建了一个广播接收器，如果有其他程序朝接收器这里发送消息，就会接收到</span></span><br><span class="line">    public void onReceive(<span class="type">Context</span> context, <span class="type">Intent</span> intent) &#123;</span><br><span class="line">        <span class="type">System</span>.out.println(<span class="string">"接收到了一条消息"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行点击发送按钮，后台输出：接收到了一条消息<br>当然，也可以附带上数据传输<br>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (v.getId())&#123;</span><br><span class="line">        <span class="keyword">case</span> R.id.btnSendMsg:</span><br><span class="line">            Intent i=<span class="keyword">new</span> Intent(<span class="keyword">this</span>,MyReceiver.class);</span><br><span class="line">            i.putExtra(<span class="string">"data"</span>,<span class="string">"good morning!"</span>);</span><br><span class="line">            sendBroadcast(i);<span class="comment">//发送广播消息</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>MyRciver.java<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span>(<span class="params">Context context, Intent intent</span>) </span>&#123;</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">"接收到了一条消息:"</span>+intent.getStringExtra(<span class="string">"data"</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行点击发送按钮：<br>后台输出：接收到了一条消息:good morning!</p>
<p>(2) 动态注册和注销 BroadcastReceiver<br>不用始终处于监听状态，用注册和注销 BroadcastReceiver<br>去fest.xml删除Receiver注册，这时候接收不到消息<br>下面直接通过程序来实现注册：<br>添加两个按钮控制注册于注销<br>Main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"发送消息"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnSendMsg"</span> /&gt;</span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"注册接收器"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnReg"</span> /&gt;</span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"注销接收器"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnUnreg"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.btnSendMsg).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnReg).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">        findViewById(R.id.btnUnreg).setOnClickListener(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> MyReceiver receiver=<span class="keyword">null</span>;<span class="comment">//防止多次注册</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnSendMsg:</span><br><span class="line">//                Intent i = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyReceiver.class);<span class="comment">//动态注册不能再用这种格式，用下面的</span></span><br><span class="line">                Intent i=<span class="keyword">new</span> Intent(MyReceiver.ACTION);<span class="comment">//直接传ACTION的方式发送---隐式Intent</span></span><br><span class="line">                i.putExtra(<span class="string">"data"</span>, <span class="string">"good morning!"</span>);</span><br><span class="line">                sendBroadcast(i);<span class="comment">//发送广播消息</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnReg:</span><br><span class="line">                <span class="keyword">if</span>(receiver==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    receiver=<span class="keyword">new</span> MyReceiver();</span><br><span class="line">                    <span class="comment">//registerReceiver(receiver,new IntentFilter(ACTION是一个字符串，有一个约定成俗的固定的格式，-可以在Myreceiver中定义));</span></span><br><span class="line">                    registerReceiver(receiver,<span class="keyword">new</span> IntentFilter(MyReceiver.ACTION));<span class="comment">//zhuc</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnUnreg:</span><br><span class="line">                <span class="keyword">if</span>(receiver != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    unregisterReceiver(receiver);<span class="comment">//注销</span></span><br><span class="line">                    receiver=<span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>Myreciver.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ACTION = <span class="string">"com.example.zhang.learnbroadcastreceiver.intent.action.MyReceiver"</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MyReceiver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="comment">//这里创建了一个广播接收器，如果有其他程序朝接收器这里发送消息，就会接收到</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"接收到了一条消息:"</span>+intent.getStringExtra(<span class="string">"data"</span>));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行点击注册之后点击发送消息才有反应，点击注销后发送消息没有反应<br>刚刚上面忘记了删除fest.xml中的自动注册，运行依然正确，应该是动态注册优先级高吧</p>
<p>(3) BroadcastReceiver 的优先级<br>先给MyReceiver添加注册信息<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">receiver</span> <span class="attribute">android:name</span>=<span class="value">".MyReceiver"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"com.example.zhang.learnbroadcastreceiver.intent.action.MyReceiver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>再创建一个接收器Myreceiver1<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span>(<span class="params">Context context, Intent intent</span>) </span>&#123;</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">"MyReceiver1 接收到消息："</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Fest.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">receiver</span> <span class="attribute">android:name</span>=<span class="value">".MyReceiver"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"com.example.zhang.learnbroadcastreceiver.intent.action.MyReceiver"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">receiver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">receiver</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">".MyReceiver1"</span></span><br><span class="line">    <span class="attribute">android:enabled</span>=<span class="value">"true"</span></span><br><span class="line">    <span class="attribute">android:exported</span>=<span class="value">"true"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"com.example.zhang.learnbroadcastreceiver.intent.action.MyReceiver"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>两个接收器用相同的action,理论上两个接收器都能接收到消息<br>运行：发现都接收到了消息，先注册的接收器先接收到消息<br>接收到了一条消息:good morning!<br>MyReceiver1 接收到消息：</p>
<p>也可以手动指定优先级<intent-filter android:priority="数字">数字越大优先级越高，越先接收到消息<br>如下MyReceiver1先接收到消息：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">receiver</span> <span class="attribute">android:name</span>=<span class="value">".MyReceiver"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span> <span class="attribute">android:priority</span>=<span class="value">"9"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"com.example.zhang.learnbroadcastreceiver.intent.action.MyReceiver"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">receiver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">receiver</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">".MyReceiver1"</span></span><br><span class="line">    <span class="attribute">android:enabled</span>=<span class="value">"true"</span></span><br><span class="line">    <span class="attribute">android:exported</span>=<span class="value">"true"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span> <span class="attribute">android:priority</span>=<span class="value">"10"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"com.example.zhang.learnbroadcastreceiver.intent.action.MyReceiver"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></intent-filter></p>
<p>如何让一个优先级高的receiver防止后面的接收器接收到数据呢？<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span>(<span class="params">Context context, Intent intent</span>) </span>&#123;</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">"MyReceiver1 接收到消息："</span>);</span><br><span class="line"></span><br><span class="line">    abortBroadcast();<span class="comment">//中断广播，优先级低于这个的将不在接收到广播消息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行如下：<br>01-21 03:17:45.761  19775-19775/com.example.zhang.learnbroadcastreceiver I/System.out﹕ MyReceiver1 接收到消息：<br>01-21 03:17:45.919  19775-19775/com.example.zhang.learnbroadcastreceiver E/BroadcastReceiver﹕ BroadcastReceiver trying to return result during a non-ordered broadcast……………….<br>01-21 03:17:46.035  19775-19775/com.example.zhang.learnbroadcastreceiver I/System.out﹕ MyReceiver 接收到了消息</p>
<p>为啥优先级低的也接收到了消息？<br>因为BroadcastReceiver trying to return result during a non-ordered broadcast<br>尝试中断的是一个非顺序的broadcast，直接用sendBroadcast(i);发送的广播消息是不能被中断的，需要改为下面才能被中断：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnSendMsg:</span><br><span class="line">//                Intent i = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, MyReceiver.class);<span class="comment">//动态注册不能再用这种格式，用下面的</span></span><br><span class="line">                Intent i=<span class="keyword">new</span> Intent(MyReceiver.ACTION);<span class="comment">//直接传ACTION的方式发送---隐式Intent</span></span><br><span class="line">                i.putExtra(<span class="string">"data"</span>, <span class="string">"good morning!"</span>);</span><br><span class="line"><span class="comment">//                sendBroadcast(i);//发送广播消息-------这个函数发送消息不能被中断</span></span><br><span class="line">                sendOrderedBroadcast(i,<span class="keyword">null</span>);<span class="comment">//第一个参数为Intent,第二个为权限--这个函数发送消息能被中断</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnReg:</span><br><span class="line">                <span class="keyword">if</span>(receiver==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    receiver=<span class="keyword">new</span> MyReceiver();</span><br><span class="line">                    <span class="comment">//registerReceiver(receiver,new IntentFilter(ACTION是一个字符串，有一个约定成俗的固定的格式，-可以在Myreceiver中定义));</span></span><br><span class="line">                    registerReceiver(receiver,<span class="keyword">new</span> IntentFilter(MyReceiver.ACTION));<span class="comment">//zhuc</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> R.id.btnUnreg:</span><br><span class="line">                <span class="keyword">if</span>(receiver != <span class="keyword">null</span>)&#123;</span><br><span class="line">                    unregisterReceiver(receiver);<span class="comment">//注销</span></span><br><span class="line">                    receiver=<span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行程序优先级低的被中断</p>
<h2 id="11-Android__u65E5_u5FD7_u7CFB_u7EDF"><a href="#11-Android__u65E5_u5FD7_u7CFB_u7EDF" class="headerlink" title="11.Android 日志系统"></a>11.Android 日志系统</h2><p>Android 日志是用来记录程序运行过程的，但是在实际开发中，由于日志信息太多导致不方便查看有效日志而影响了正常的开发调试工作，所以学会对日志进行分类查看非常重要。<br>核心内容：System.out;System.err;Android Log 类;日志分类过滤</p>
<p>(1) 使用日志 API<br>讲解在 Android 系统中如何使用日志 API 进行日志输出，内容包括 System.out、System.err、Log.v、Log.d、Log.i、Log.w、Log.e 的使用。<br>创建一个项目LearnLog<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.<span class="built_in">println</span>(<span class="string">"普通日志"</span>);<span class="comment">// System.out.println（）属于普通日志</span></span><br><span class="line">System.err.<span class="built_in">println</span>(<span class="string">"错误日志"</span>);</span><br></pre></td></tr></table></figure></p>
<p>运行输出：<br>1349-1349/com.example.zhang.learnlog I/System.out﹕ 普通日志<br>1349-1349/com.example.zhang.learnlog W/System.err﹕ 错误日志<br>I—-Info——-普通消息<br>W—-Warning——–警告信息<br>Log level:消息类型<br>Verbose:最低—–全部显示<br>Info——显示info信息以及比他高的信息<br><img src="/img/android/38.png" alt="image"><br>上面是java提供的android还提供了非常详细的日志信息Log.里面有很多信息<br>//安卓提供从高到低日志信息如下<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Log</span><span class="built_in">.</span>e(<span class="built_in">TAG</span>,<span class="string">"错误信息"</span>);<span class="comment">//error</span></span><br><span class="line"><span class="keyword">Log</span><span class="built_in">.</span>w(<span class="built_in">TAG</span>,<span class="string">"警告信息"</span>);<span class="comment">//warn</span></span><br><span class="line"><span class="keyword">Log</span><span class="built_in">.</span>i(<span class="built_in">TAG</span>,<span class="string">"普通信息"</span>);<span class="comment">//info</span></span><br><span class="line"><span class="keyword">Log</span><span class="built_in">.</span>d(<span class="built_in">TAG</span>,<span class="string">"调试信息"</span>);<span class="comment">//debug</span></span><br><span class="line"><span class="keyword">Log</span><span class="built_in">.</span>v(<span class="built_in">TAG</span>,<span class="string">"无用信息"</span>);<span class="comment">//verbose 比如：一个程序员可以输出唠叨信息---这段程序好难写啊</span></span><br></pre></td></tr></table></figure></p>
<p>(2) 日志分类<br>如何对日志进行分类呈现，便于开发调试。<br><img src="/img/android/39.png" alt="image"><br>No Filters—————-显示全部应用程序的日志信息<br>Show only selected application————只是显示当前应用的日志信息</p>
<p>Edit Filters Configuration———-编辑路径：可以自定义标签<br>如只是输出MainActivity标签的信息：<br><img src="/img/android/40.png" alt="image"><br>则显示信息都是MainActivity标签的<br>Tag-标签     Message—–内容  pid——程序进程id</p>
<p>(3) 使用 DDMS 查看日志<br>DDMS 以及独立的 DDMS 查看日志<br>DDMS———-设备监听器<br><img src="/img/android/41.png" alt="image"><br>点击可以启动一个应用<br><img src="/img/android/42.png" alt="image"><br>选择一个设备，如下面一个模拟器<br>可以看到日志信息<br><img src="/img/android/43.png" alt="image"><br>可以点击上面绿色的加号<br><img src="/img/android/44.png" alt="image"><br>DDMS可以独立于开发环境启动<br>点击E:\Android\SDK\tools\ddms.bat就可以启动<br>DDMS可以用于调试<br>如下：<br>可以模拟拨打电话、发短信到模拟手机<br>其他还有好多功能自己尝试<br><img src="/img/android/45.png" alt="image"></p>
<h2 id="11-Android__u6743_u9650_u7CFB_u7EDF"><a href="#11-Android__u6743_u9650_u7CFB_u7EDF" class="headerlink" title="11.Android 权限系统"></a>11.Android 权限系统</h2><p>在 Android 中有非常完善的权限控制机制，开发者需要懂得如何使用，普通用户需要懂得如何分辨，结合起来才能够有效的阻止 Android 平台病毒的传播。<br>核心内容：定义权限;在代码中做权限检查;为基本组件添加权限检查<br>(1) 请求权限实例<br>创建项目LearnWebview<br>Main.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//WebView-----网页</span><br><span class="line"><span class="tag">&lt;<span class="title">WebView</span></span><br><span class="line">    <span class="attribute">android:layout_width</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:layout_height</span>=<span class="value">"match_parent"</span></span><br><span class="line">    <span class="attribute">android:id</span>=<span class="value">"@+id/wv"</span>&gt;</span><span class="tag">&lt;/<span class="title">WebView</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> WebView wv;</span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">    wv= (WebView) findViewById(R.id.wv);</span><br><span class="line">    <span class="comment">//用wv加载一个主页</span></span><br><span class="line">    wv.loadUrl(<span class="string">"http://www.bestzhangjin.com"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行：<br>会提醒我们无法访问网页，并且有很多的错误，这是因为loadUrl(“<a href="http://www.bestzhangjin.com">http://www.bestzhangjin.com</a>“) 加载一个网页需要一个权限<br>就是互联网的访问权限<br>需要在fest.xml中进行声明<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission <span class="string">android:</span>name=<span class="string">"android.permission.INTERNET"</span><span class="regexp">/&gt;/</span>/声明访问互联网权限</span><br><span class="line"></span><br><span class="line">&lt;application</span><br></pre></td></tr></table></figure></p>
<p>这时候重新运行可以访问到主页<br><img src="/img/android/46.png" alt="image"><br>用loadUrl(“<a href="http://bestzhangjin.com&quot;)时没有www.会自动跳转到http://www.bestzhangjin.com" target="_blank" rel="external">http://bestzhangjin.com&quot;)时没有www.会自动跳转到http://www.bestzhangjin.com</a> </p>
<p>在APPInfo中可以查看到权限</p>
<p>(2) 为代码添加权限检查<br>新建一个类Hello.java<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Hello</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final String PERMISSION_SAY_HELLO=<span class="string">"com.example.zhang.learnwebview.permission.sayHello"</span>;</span><br><span class="line">    <span class="comment">//用下面的方法检测程序是否有执行权限</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sayHello</span>(<span class="params">Context context</span>)</span>&#123;<span class="comment">//利用Context才能够访问到一下全局的属性</span></span><br><span class="line">        <span class="keyword">int</span> checkResult=context.checkCallingOrSelfPermission(PERMISSION_SAY_HELLO);<span class="comment">//执行程序的代码是否拥有这个权限</span></span><br><span class="line">        <span class="keyword">if</span>(checkResult != PackageManager.PERMISSION_GRANTED)&#123;<span class="comment">//PERMISSION_GRANTED---允许，PERMISSION_DENIED--拒绝</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SecurityException(<span class="string">"执行sayhello方法需要有com.example.zhang.learnwebview.permission.sayHello权限！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">"你有权限，已经执行"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>fest.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!---  新注册一个权限，权限的名字为com.example.zhang.learnwebview.permission.sayHello   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">permission</span> <span class="attribute">android:name</span>=<span class="value">"com.example.zhang.learnwebview.permission.sayHello"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello.sayHello(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p>
<p>运行出现异常：Unfortunately,。。。。。。。。stopped<br>后台输出提示执行sayhello方法需要有com.example.zhang.learnwebview.permission.sayHello权限！</p>
<p>下面填写权限：<br>Fest.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!---  新注册一个权限，权限的名字为com.example.zhang.learnwebview.permission.sayHello   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">permission</span> <span class="attribute">android:name</span>=<span class="value">"com.example.zhang.learnwebview.permission.sayHello"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  获取权限 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"com.example.zhang.learnwebview.permission.sayHello"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>再次运行成功！输出：你有权限，已经执行</p>
<p>(3) 为基本组件添加权限检查<br>Android四大组件都可以使用相同的方式来配置权限<br>这里也activity为例<br>新建一个activity名字MyAty<br>MyAty.xml<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView <span class="string">android:</span>text=<span class="string">"这是一个被启动的activity"</span> <span class="string">android:</span>layout_width=<span class="string">"wrap_content"</span></span><br><span class="line"><span class="label">    android:</span>layout_height=<span class="string">"wrap_content"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Fest.xml声明权限<br>注意：fest.xml中在顶部和被启动的activity中都要声明<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;permission android:<span class="property">name</span>=<span class="string">"com.example.zhang.learnwebview.permission.MYATY"</span>/&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">".MyAty"</span></span><br><span class="line">    <span class="attribute">android:label</span>=<span class="value">"@string/title_activity_my_aty"</span></span><br><span class="line">    <span class="attribute">android:permission</span>=<span class="value">"com.example.zhang.learnwebview.permission.MYATY"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p>Main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"启动MyAty"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnStartMyAty"</span>/&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">findViewById(R.id.btnStartMyAty).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        startActivity(<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>,MyAty.class ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>可以运行，因为是在一个应用之内<br>用另外一个应用启动这个activity则不行，需要加权限<br>新建一个module<br>OtherApp.main.xml加一个按钮<br>这里采用action方法启动另外一个应用的activity<br>所以先在被启动的应用的fest.xml的activity配置下加上action<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">activity</span></span><br><span class="line">    <span class="attribute">android:name</span>=<span class="value">".MyAty"</span></span><br><span class="line">    <span class="attribute">android:label</span>=<span class="value">"@string/title_activity_my_aty"</span></span><br><span class="line">    <span class="attribute">android:permission</span>=<span class="value">"com.example.zhang.learnwebview.permission.MYATY"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"android.intent.category.DEFAULT"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"com.example.zhang.learnwebview.intent.action.MyAty"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">activity</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>OtherApp.main.java<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">findViewById(R.id.btnStartMyAty).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//通过action启动其他应用的activity</span></span><br><span class="line">        startActivity(<span class="keyword">new</span> Intent(<span class="string">"com.example.zhang.learnwebview.intent.action.MyAty"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>运行按下按钮显示onfutunately——–退出<br>因为没有权限<br>在OtherApp.fest.xml前面加上使用声明<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="property">name</span>=<span class="string">"com.example.zhang.learnwebview.permission.MYATY"</span>/&gt;</span><br></pre></td></tr></table></figure></p>
<p>之后运行正常</p>
<h1 id="u7B2C_u4E09_u7AE0__u7528_u6237_u754C_u9762_u4F18_u5316"><a href="#u7B2C_u4E09_u7AE0__u7528_u6237_u754C_u9762_u4F18_u5316" class="headerlink" title="第三章 用户界面优化"></a>第三章 用户界面优化</h1><h2 id="1-Android_Fragment"><a href="#1-Android_Fragment" class="headerlink" title="1.Android Fragment"></a>1.Android Fragment</h2><p>Fragment 是 Android 中在同一个应用内部用于替换 Activity 界面跳转的机制，她高效灵活，是 Android 开发中不可缺少的。<br>核心内容：认识 Fragment；Fragment 生命周期；Fragment 的应用<br>Activity是比较重量级的基本组件，同一个程序内部界面切换不合适</p>
<p>(1) 使用 Fragment<br>创建一个with–Fragment项目<br><img src="/img/android/47.png" alt="image"><br>Main.xml—自动生成<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;fragment <span class="string">xmlns:</span>android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line"><span class="label">    xmlns:</span>tools=<span class="string">"http://schemas.android.com/tools"</span> <span class="string">android:</span>id=<span class="string">"@+id/fragment"</span></span><br><span class="line"><span class="label">    android:</span>name=<span class="string">"com.example.zhang.fragment.MainActivityFragment"</span></span><br><span class="line"><span class="label">    tools:</span>layout=<span class="string">"@layout/fragment_main"</span> <span class="string">android:</span>layout_width=<span class="string">"match_parent"</span></span><br><span class="line"><span class="label">    android:</span>layout_height=<span class="string">"match_parent"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Fragment_main.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"呈现另一个fragment"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnShowAnotherFragment"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Fragment_another.xml<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"这是另外一个fragment"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/textView"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Button</span><br><span class="line">    android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">    android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">    android:<span class="type">text</span>=<span class="string">"后退"</span></span><br><span class="line">    android:<span class="property">id</span>=<span class="string">"@+id/btnBack"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<p>Main.java自动<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">        <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">        <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">        <span class="keyword">int</span> id = item.getItemId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">        <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onOptionsItemSelected</span><span class="params">(item)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>MainActivityFragment.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivityFragment</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Fragment</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    public <span class="type">MainActivityFragment</span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    public <span class="type">View</span> onCreateView(<span class="type">LayoutInflater</span> inflater, <span class="type">ViewGroup</span> container,</span><br><span class="line">                             <span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="type">View</span> rootView = inflater.inflate(<span class="type">R</span>.layout.fragment_main, container, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//添加事件监听器</span></span><br><span class="line">        rootView.findViewById(<span class="type">R</span>.id.btnShowAnotherFragment).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">                getFragmentManager().beginTransaction()</span><br><span class="line">                        .addToBackStack(<span class="literal">null</span>)<span class="comment">//后退键------没有这行后退键将直接退出程序</span></span><br><span class="line">                        .replace(<span class="type">R</span>.id.fragment,<span class="keyword">new</span> <span class="type">AnotherFragment</span>()).commit();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> rootView;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>AnotherFragment.java<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">AnotherFragment</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Fragment</span> &#123;</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    public <span class="type">View</span> onCreateView(<span class="type">LayoutInflater</span> inflater, <span class="type">ViewGroup</span> container, <span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">        <span class="comment">/////////////java文件解析对应的.xml</span></span><br><span class="line">        <span class="type">View</span> root=inflater.inflate(<span class="type">R</span>.layout.fragment_another, container, <span class="literal">false</span>);</span><br><span class="line">        root.findViewById(<span class="type">R</span>.id.btnBack).setOnClickListener(<span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            public void onClick(<span class="type">View</span> v) &#123;</span><br><span class="line">                getFragmentManager().popBackStack();<span class="comment">//实现后退操作</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行仿真如下，我的是在一个界面内，极客学院的在不同的界面内<br><img src="/img/android/48.png" alt="image"></p>
<p>(2)Fragment 的生命周期<br>Fragment生命周期图如下:<br><img src="/img/android/49.png" alt="image"><br>一般知道三个即可：onCreate(),onCreateView(),onPause()<br>将AnotherFragment.java修改如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnotherFragment</span> <span class="keyword">extends</span> <span class="title">Fragment</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onCreateView"</span>);</span><br><span class="line">        View rootView = inflater.inflate(R.layout.fragment_another, container, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> rootView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onCreate"</span>);</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onPause"</span>);</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"onDestroy"</span>);</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行点击按钮显示AnotherFragment，后台输出：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">26</span>:<span class="number">48.192</span>    <span class="number">9321</span>-<span class="number">9321</span>/com.zhang.learnfragment I/System.out﹕ onCreate</span><br><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">26</span>:<span class="number">48.192</span>    <span class="number">9321</span>-<span class="number">9321</span>/com.zhang.learnfragment I/System.out﹕ onCreateView</span><br></pre></td></tr></table></figure></p>
<p>退出时输出：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">32</span>:<span class="number">10.003</span>  <span class="number">11763</span>-<span class="number">11763</span>/com.zhang.learnfragment I/System.out﹕ onPause</span><br><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">32</span>:<span class="number">10.018</span>  <span class="number">11763</span>-<span class="number">11763</span>/com.zhang.learnfragment I/System.out﹕ onDestroy</span><br></pre></td></tr></table></figure></p>
<p>下面讨论第二个fragment把第一个fragment覆盖的情况。<br>将MainActivityFragment.java修改如下:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivityFragment</span> <span class="keyword">extends</span> <span class="title">android</span>.<span class="title">app</span>.<span class="title">Fragment</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainActivityFragment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">onCreateView</span><span class="params">(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">                             Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"A onCreateView"</span>);</span><br><span class="line">        View rootView = inflater.inflate(R.layout.fragment_main, container, <span class="keyword">false</span>);</span><br><span class="line">        rootView.findViewById(R.id.btnShowAnotherFragment).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                getFragmentManager().beginTransaction().replace(R.id.fragment</span><br><span class="line">                <span class="comment">/*主容器(activity_main.xml里的ID)*/</span>, <span class="keyword">new</span> AnotherFragment()<span class="comment">/*新的fragment*/</span>).commit();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> rootView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"A onCreate"</span>);</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"A onPause"</span>);</span><br><span class="line">        <span class="keyword">super</span>.onPause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"A onDestroy"</span>);</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>运行时：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">38</span>:<span class="number">06.686</span>  <span class="number">14543</span>-<span class="number">14543</span>/com.zhang.learnfragment I/System.out﹕ A onCreate</span><br><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">38</span>:<span class="number">06.686</span>  <span class="number">14543</span>-<span class="number">14543</span>/com.zhang.learnfragment I/System.out﹕ A onCreateView</span><br></pre></td></tr></table></figure></p>
<p>点击按钮显示下一个fragment,我这里两个fragment都在显示，所以出现了这个情况，A并没有onpause<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">39</span>:<span class="number">08.782</span>  <span class="number">14543</span>-<span class="number">14543</span>/com.zhang.learnfragment I/System.out﹕ onCreate</span><br><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">39</span>:<span class="number">08.782</span>  <span class="number">14543</span>-<span class="number">14543</span>/com.zhang.learnfragment I/System.out﹕ onCreateView</span><br></pre></td></tr></table></figure></p>
<p>退出<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">40</span>:<span class="number">34.260</span>  <span class="number">14543</span>-<span class="number">14543</span>/com.zhang.learnfragment I/System.out﹕ A onPause</span><br><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">40</span>:<span class="number">34.260</span>  <span class="number">14543</span>-<span class="number">14543</span>/com.zhang.learnfragment I/System.out﹕ onPause</span><br><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">40</span>:<span class="number">34.272</span>  <span class="number">14543</span>-<span class="number">14543</span>/com.zhang.learnfragment I/System.out﹕ A onDestroy</span><br><span class="line"><span class="number">05</span>-<span class="number">08</span> <span class="number">03</span>:<span class="number">40</span>:<span class="number">34.272</span>  <span class="number">14543</span>-<span class="number">14543</span>/com.zhang.learnfragment I/System.out﹕ onDestroy</span><br></pre></td></tr></table></figure></p>
<p>(3)带侧边栏的 Activity<br>新建activity如下：<br><img src="/img/android/50.png" alt="image"></p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag">#Android</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/03/15/question/" rel="next" title="软件工程师常见问题汇总">
                <i class="fa fa-chevron-left"></i> 软件工程师常见问题汇总
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/03/30/jQuery/" rel="prev" title="jQuery教程">
                jQuery教程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2016/03/24/android/"
     data-title="Android开发"
     data-content=""
     data-url="http://www.bestzhangjin.com/2016/03/24/android/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


        </div>

        


        
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/03/24/android/"
           data-title="Android开发" data-url="http://www.bestzhangjin.com/2016/03/24/android/">
      </div>
    
  </div>


      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.jpeg" alt="Jin Zhang" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Jin Zhang</p>
        </div>
        <p class="site-description motion-element" itemprop="description">天高任鸟飞，海阔凭鱼跃。</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">33</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">27</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">45</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#u7B2C_u4E00_u7AE0__u73AF_u5883_u642D_u5EFA"><span class="nav-number">1.</span> <span class="nav-text">第一章 环境搭建</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#u7B2C_u4E8C_u7AE0_Android_u57FA_u7840_u77E5_u8BC6"><span class="nav-number">2.</span> <span class="nav-text">第二章 Android基础知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-_u4ECB_u7ECD"><span class="nav-number">2.1.</span> <span class="nav-text">1.介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Activity_u7EC4_u4EF6"><span class="nav-number">2.2.</span> <span class="nav-text">2.Activity组件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-_u8BA4_u8BC6_Activity__u7684_u751F_u547D_u5468_u671F"><span class="nav-number">2.3.</span> <span class="nav-text">2.认识 Activity 的生命周期</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-_u5728_Activity__u4E4B_u95F4_u4F20_u9012_u53C2_u6570"><span class="nav-number">2.4.</span> <span class="nav-text">3.在 Activity 之间传递参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Android__u4E2D_Activity__u542F_u52A8_u6A21_u5F0F"><span class="nav-number">2.5.</span> <span class="nav-text">4.Android 中 Activity 启动模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-_u5728_Android__u4E2D_Intent__u7684_u6982_u5FF5_u53CA_u5E94_u7528"><span class="nav-number">2.6.</span> <span class="nav-text">5.在 Android 中 Intent 的概念及应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Android__u4E2D_Context__u7684_u7406_u89E3_u53CA_u4F7F_u7528"><span class="nav-number">2.7.</span> <span class="nav-text">6.Android 中 Context 的理解及使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-_u8BA4_u8BC6_Android_Service"><span class="nav-number">2.8.</span> <span class="nav-text">7.认识 Android Service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Android__u4E2D_Service__u901A_u4FE1"><span class="nav-number">2.9.</span> <span class="nav-text">8.Android 中 Service 通信</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-Android__u4E2D_AIDL__u7684_u7406_u89E3_u4E0E_u4F7F_u7528"><span class="nav-number">2.10.</span> <span class="nav-text">9.Android 中 AIDL 的理解与使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-Android__u5E7F_u64AD_u63A5_u6536_u5668_BroadcastReceiver"><span class="nav-number">2.11.</span> <span class="nav-text">10.Android 广播接收器 BroadcastReceiver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-Android__u65E5_u5FD7_u7CFB_u7EDF"><span class="nav-number">2.12.</span> <span class="nav-text">11.Android 日志系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-Android__u6743_u9650_u7CFB_u7EDF"><span class="nav-number">2.13.</span> <span class="nav-text">11.Android 权限系统</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#u7B2C_u4E09_u7AE0__u7528_u6237_u754C_u9762_u4F18_u5316"><span class="nav-number">3.</span> <span class="nav-text">第三章 用户界面优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Android_Fragment"><span class="nav-number">3.1.</span> <span class="nav-text">1.Android Fragment</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jin Zhang</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"bestzhangjin"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    motionMiddleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');
      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    };
  });
</script>



  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
